

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>PSA Protected Storage &mdash; Zephyr Project Documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/zephyr.css" type="text/css" />

  
  

  
  

  

  
  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-210766333-2"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
  <script type="text/javascript" src="../../../_static/js/zcaniot.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="TF-M IPC" href="../tfm_ipc/README.html" />
    <link rel="prev" title="TF-M PSA crypto" href="../psa_crypto/README.html" />
  <link rel="shortcut icon" href="../../../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Zephyr Project
          

          
          </a>

          
            
            
              <div class="version">
                3.0.99
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Samples and Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../classic.html">Classic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html">Basic Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../userspace/index.html">Userspace Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsys/subsys.html">Various Subsystems Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../net/net.html">Networking Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/bluetooth.html">Bluetooth samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sensor/sensor.html">Sensor Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../arch/index.html">Architecture Dependent Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../boards/boards.html">Board-specific samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../drivers/drivers.html">Driver Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../application_development/application_development.html">Application development samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shields/shields.html">Shields Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../posix/posix.html">POSIX Subsystem Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kernel/index.html">Various Kernel and Scheduler Samples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tfm_integration.html">TF-M Integration Samples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../psa_crypto/README.html">TF-M PSA crypto</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">PSA Protected Storage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-and-running">Building and Running</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tfm_ipc/README.html">TF-M IPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tfm_psa_test/README.html">TF-M Platform Security Architecture Test Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tfm_regression_test/README.html">TF-M Regression Test Sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tfm_secure_partition/README.html">TF-M Secure Partition Sample</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tfm_integration.html#trusted-firmware-m-tf-m">Trusted Firmware-M (TF-M)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/index.html">External Module Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../compression/compression.html">Compression Samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Samples and Demos</a> &raquo;</li>
        
          <li><a href="../tfm_integration.html">TF-M Integration Samples</a> &raquo;</li>
        
      <li>PSA Protected Storage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/samples/tfm_integration/psa_protected_storage/README.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="psa-protected-storage">
<h1>PSA Protected Storage<a class="headerlink" href="#psa-protected-storage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This sample demonstrates how the Protected Storage (PS) API can be used for storing data.</p>
<p>Protected storage provides a key/value storage interface where data is (by default) encrypted, with
optional authentication and rollback protection. The default crypto algorithm is <code class="docutils literal notranslate"><span class="pre">AES-128-GCM</span></code>.
The encryption key is derived from the Hardware Unique Key (HUK), which is often set via device
fuses, etc.</p>
<p>Using the PS API, this sample stores data to non-volatile storage. The sample shows how data can
be stored to and read from UIDs, and how overwrite protection can be enabled using flags.</p>
<p>TF-M includes a maximum number of PS records, set via <code class="docutils literal notranslate"><span class="pre">PS_NUM_ASSETS</span></code> (default 10 as of
TF-M 1.3.0), and a maximum record size, set via <code class="docutils literal notranslate"><span class="pre">PS_MAX_ASSET_SIZE</span></code> (default of 2048 as of
TF-M 1.3.0). These defaults may be different depending on the platform being used, the current
value will be printed by the build system during the TF-M compilation step.</p>
<p>More information about Protected Storage can be found in the Platform Security Architecture (PSA)
Secure Storage API: <a class="reference external" href="https://developer.arm.com/architectures/architecture-security-features/platform-security">https://developer.arm.com/architectures/architecture-security-features/platform-security</a></p>
<p>This sample is available for platforms that are supported in the trusted-firmware-m repo:
<a class="reference external" href="https://git.trustedfirmware.org/TF-M/trusted-firmware-m.git/">https://git.trustedfirmware.org/TF-M/trusted-firmware-m.git/</a>
See sample.yaml for a list of supported platforms.</p>
</div>
<div class="section" id="building-and-running">
<h2>Building and Running<a class="headerlink" href="#building-and-running" title="Permalink to this headline">¶</a></h2>
<div class="section" id="on-target">
<h3>On Target<a class="headerlink" href="#on-target" title="Permalink to this headline">¶</a></h3>
<p>Refer to <a class="reference internal" href="../psa_crypto/README.html#tfm-psa-crypto"><span class="std std-ref">TF-M PSA crypto</span></a> for detailed instructions.</p>
<p>Note that the board needs to be completely erased before programming the sample, as the flash area
used might contain data from before. The board must also be erased between each time the sample is
run as the overwrite protection will not be removed with a power reset.</p>
</div>
<div class="section" id="on-qemu">
<h3>On QEMU<a class="headerlink" href="#on-qemu" title="Permalink to this headline">¶</a></h3>
<p>Refer to <a class="reference internal" href="../tfm_ipc/README.html#tfm-ipc"><span class="std std-ref">TF-M IPC</span></a> for detailed instructions.
Following is an example based on <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">build</span></code></p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ west build samples/tfm_integration/psa_protected_storage/ -p -b mps2_an521_ns -t run
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="sample-output">
<h3>Sample Output<a class="headerlink" href="#sample-output" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">*** Booting Zephyr OS build zephyr-v2.5.0-2791-g5585355dde0c  ***</span>
<span class="go">TF-M Protected Storage sample started. PSA Protected Storage API Version 1.0</span>
<span class="go">Writing data to UID1: The quick brown fox jumps over the lazy dog</span>
<span class="go">Info on data stored in UID1:</span>
<span class="go">- Size: 16</span>
<span class="go">- Capacity: 0x42</span>
<span class="go">- Flags: 0x 0</span>
<span class="go">Read and compare data stored in UID1</span>
<span class="go">Data stored in UID1: The quick brown fox jumps over the lazy dog</span>
<span class="go">Overwriting data stored in UID1 with: Lorem ipsum dolor sit amet</span>
<span class="go">Writing data to UID2 with overwrite protection: The quick brown fox jumps over the lazy dog</span>
<span class="go">Attempting to write &#39;The quick brown fox jumps over the lazy dog&#39; to UID2</span>
<span class="go">Got expected error (PSA_ERROR_NOT_PERMITTED) when writing to protected UID</span>
<span class="go">Removing UID1</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tfm_ipc/README.html" class="btn btn-neutral float-right" title="TF-M IPC" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../psa_crypto/README.html" class="btn btn-neutral" title="TF-M PSA crypto" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; <a href="../../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      Last updated on May 10, 2022.

    </p>
</td>
<td id="zcanlogo">
  <a href="https://www.unisim-micro.com/"><img src="../../../_static/images/zcan.svg" border="0" style="position:static"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version zcansdk">
        <a href="../../../../zcansdk/index.html">ZCAN IOT SDK</a>
      </div>
      
      <div class="rst-other-version zcanxlib">
        <a href="../../../../zcanxlib/README.html">ZCAN Xlib</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version sof">
        <a href="../../../../sof/index.html">SOF</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>