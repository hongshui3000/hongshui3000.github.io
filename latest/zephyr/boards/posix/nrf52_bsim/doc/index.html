

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>NRF52 simulated board (BabbleSim) &mdash; Zephyr Project Documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/zephyr.css" type="text/css" />

  
  

  
  

  

  
  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-210766333-2"></script>
        <script src="../../../../_static/js/ga-tracker.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
  <script type="text/javascript" src="../../../../_static/js/zcaniot.js"></script>

    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../../copyright.html" />
    <link rel="next" title="RISCV Boards" href="../../../riscv/index.html" />
    <link rel="prev" title="Native POSIX execution (native_posix)" href="../../native_posix/doc/index.html" />
  <link rel="shortcut icon" href="../../../../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Zephyr Project
          

          
          </a>

          
            
            
              <div class="version">
                3.0.99
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides/index.html">User and Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Supported Boards</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../x86/index.html">x86 Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arm/index.html">ARM Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arm64/index.html">ARM64 Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arc/index.html">ARC Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mips/index.html">MIPS Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nios2/index.html">NIOS II Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../xtensa/index.html">XTENSA Boards</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">POSIX/NATIVE Boards</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../native_posix/doc/index.html">Native POSIX execution (native_posix)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">NRF52 simulated board (BabbleSim)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-and-running">Building and running</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging">Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#about-time-in-babblesim">About time in BabbleSim</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../riscv/index.html">RISCV Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sparc/index.html">SPARC Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../shields/index.html">Shields</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases/index.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Zephyr Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Supported Boards</a> &raquo;</li>
        
          <li><a href="../../index.html">POSIX/NATIVE Boards</a> &raquo;</li>
        
      <li>NRF52 simulated board (BabbleSim)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/boards/posix/nrf52_bsim/doc/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="nrf52-simulated-board-babblesim">
<span id="nrf52-bsim"></span><h1>NRF52 simulated board (BabbleSim)<a class="headerlink" href="#nrf52-simulated-board-babblesim" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id1">Overview</a></p></li>
<li><p><a class="reference internal" href="#building-and-running" id="id2">Building and running</a></p></li>
<li><p><a class="reference internal" href="#debugging" id="id3">Debugging</a></p></li>
<li><p><a class="reference internal" href="#about-time-in-babblesim" id="id4">About time in BabbleSim</a></p></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id1">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This is a simulated NRF52 board which uses <a class="reference external" href="https://BabbleSim.github.io">BabbleSim</a> to simulate the radio
activity.
This board models some of the NRF52 SOC peripherals:</p>
<ul class="simple">
<li><p>Radio</p></li>
<li><p>Timers</p></li>
<li><p>Real time counter</p></li>
<li><p>Random number generator</p></li>
<li><p>AES CCM &amp; AES ECB encryption HW</p></li>
<li><p>Accelerated address resolver</p></li>
<li><p>Clock control</p></li>
<li><p>PPI (Programmable Peripheral Interconnect)</p></li>
</ul>
<p>The nrf52_bsim board definition uses the POSIX architecture to
run applications natively on the development system.  As with
the <code class="docutils literal notranslate"><span class="pre">native_posix</span></code> board, this has the benefit of providing
native code execution performance and easy debugging using
native tools, but has the same drawbacks.  Please refer to
<a class="reference internal" href="../../native_posix/doc/index.html#native-important-limitations"><span class="std std-ref">Native Posix’s important limitations</span></a>
for more details.</p>
</div>
<div class="section" id="building-and-running">
<span id="nrf52bsim-build-and-run"></span><h2><a class="toc-backref" href="#id2">Building and running</a><a class="headerlink" href="#building-and-running" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must have the 32-bit C library installed in your system
(in Ubuntu 16.04 install the gcc-multilib package)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will <strong>not</strong> work in Windows Subsystem for Linux (WSL) because WSL
does not support native 32-bit binaries.</p>
</div>
<p>To target this board you need to have <a class="reference external" href="https://BabbleSim.github.io">BabbleSim</a> compiled in your system.
If you do not have it yet, in <a class="reference external" href="https://BabbleSim.github.io">its web page</a>
you can find instructions on how to
<a class="reference external" href="https://babblesim.github.io/fetching.html">fetch</a> and
<a class="reference external" href="https://babblesim.github.io/building.html">build</a> it.
In short, you can do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p ${HOME}/bsim &amp;&amp; cd ${HOME}/bsim</span>
<span class="go">curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ./repo  &amp;&amp; chmod a+x ./repo</span>
<span class="go">./repo init -u https://github.com/BabbleSim/manifest.git -m everything.xml -b master</span>
<span class="go">./repo sync</span>
<span class="go">make everything -j 8</span>
</pre></div>
</div>
<p>Define two environment variables to point to your BabbleSim
installation, <code class="docutils literal notranslate"><span class="pre">BSIM_OUT_PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">BSIM_COMPONENTS_PATH</span></code>.
If you followed the previous steps, you can just do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export BSIM_OUT_PATH=${HOME}/bsim/</span>
<span class="go">export BSIM_COMPONENTS_PATH=${HOME}/bsim/components/</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can add these two lines to your <code class="docutils literal notranslate"><span class="pre">~/.zephyrrc</span></code> file, or to your shell
initialization script (<code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code>), so you won’t need to rerun them
manually for each new shell.</p>
</div>
<p>You’re now ready to build applications targeting this board, for example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52_bsim samples/hello_world</span>
</pre></div>
</div>
<p>Then you can execute your application using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./build/zephyr/zephyr.exe -nosim
<span class="gp"># </span>Press Ctrl+C to <span class="nb">exit</span>
</pre></div>
</div>
<p>Note that the executable is a BabbleSim executable. The <code class="docutils literal notranslate"><span class="pre">-nosim</span></code> command line
option indicates you want to run it detached from a BabbleSim simulation. This
is possible only while there is no radio activity. But is perfectly fine for
most Zephyr samples and tests.</p>
<p>When you want to run a simulation with radio activity you need to run also the
BableSim 2G4 (2.4GHz) physical layer simulation (phy).</p>
<p>For example, if you would like to run a simple case with 1 BLE <code class="docutils literal notranslate"><span class="pre">central_hr</span></code>
sample application connecting to a BLE <code class="docutils literal notranslate"><span class="pre">peripheral</span></code> sample application:
Build the <code class="docutils literal notranslate"><span class="pre">central_hr</span></code> application targeting this board and copy the resulting
executable to the simulator bin folder with a sensible name:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52_bsim samples/bluetooth/central_hr</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cp build/zephyr/zephyr.exe <span class="se">\</span>
<span class="gp">  $</span><span class="o">{</span>BSIM_OUT_PATH<span class="o">}</span>/bin/bs_nrf52_bsim_samples_bluetooth_central_hr
</pre></div>
</div>
<p>Do the same for the <code class="docutils literal notranslate"><span class="pre">peripheral</span></code> sample app:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">west build -b nrf52_bsim samples/bluetooth/peripheral</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cp build/zephyr/zephyr.exe <span class="se">\</span>
<span class="gp">  $</span><span class="o">{</span>BSIM_OUT_PATH<span class="o">}</span>/bin/bs_nrf52_bsim_samples_bluetooth_peripheral
</pre></div>
</div>
<p>And then run them together with BabbleSim’s 2G4 physical layer simulation:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ${BSIM_OUT_PATH}/bin/</span>
<span class="go">./bs_nrf52_bsim_samples_bluetooth_peripheral -s=trial_sim -d=0 &amp;</span>
<span class="go">./bs_nrf52_bsim_samples_bluetooth_central_hr -s=trial_sim -d=1 &amp;</span>
<span class="go">./bs_2G4_phy_v1 -s=trial_sim -D=2 -sim_length=10e6 &amp;</span>
</pre></div>
</div>
<p>Where the <code class="docutils literal notranslate"><span class="pre">-s</span></code> command line option provides a string which uniquely identifies
this simulation; the <code class="docutils literal notranslate"><span class="pre">-D</span></code> option tells the Phy how many devices will be run
in this simulation; the <code class="docutils literal notranslate"><span class="pre">-d</span></code> option tells each device which is its device
number in the simulation; and the <code class="docutils literal notranslate"><span class="pre">-sim_length</span></code> option specifies the length
of the simulation in microseconds.
BabbleSim devices and Phy support many command line switches.
Run them with <code class="docutils literal notranslate"><span class="pre">-help</span></code> for more information.</p>
<p>You can find more information about how to run BabbleSim simulations in
<a class="reference external" href="https://babblesim.github.io/example_2g4.html">this BabbleSim example</a>.</p>
</div>
<div class="section" id="debugging">
<h2><a class="toc-backref" href="#id3">Debugging</a><a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>Just like native_posix, the resulting executables are Linux native applications.
Therefore they can be debugged or instrumented with the same tools as any other
native application, like for example <code class="docutils literal notranslate"><span class="pre">gdb</span></code> or <code class="docutils literal notranslate"><span class="pre">valgrind</span></code>.</p>
<p>Note that BabbleSim will run fine if one or several of its components are
being run in a debugger or instrumented. For example, pausing a device in a
breakpoint will pause the whole simulation.</p>
<p>BabbleSim is fully deterministic by design and the results are not affected by
the host computing speed. All randomness is controlled by random seeds which can
be provided as command line options.</p>
</div>
<div class="section" id="about-time-in-babblesim">
<h2><a class="toc-backref" href="#id4">About time in BabbleSim</a><a class="headerlink" href="#about-time-in-babblesim" title="Permalink to this headline">¶</a></h2>
<p>Note that time in BabbleSim is simulated and decoupled from real time. Normally
simulated time will pass several orders of magnitude faster than real time,
only limited by your workstation compute power.
If for some reason you want to limit the speed of the simulation to real
time or a ratio of it, you can do so by connecting the <a class="reference external" href="https://github.com/BabbleSim/base/tree/master/device_handbrake">handbrake device</a>
to the BabbleSim Phy.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../riscv/index.html" class="btn btn-neutral float-right" title="RISCV Boards" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../native_posix/doc/index.html" class="btn btn-neutral" title="Native POSIX execution (native_posix)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; <a href="../../../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      Last updated on May 10, 2022.

    </p>
</td>
<td id="zcanlogo">
  <a href="https://www.unisim-micro.com/"><img src="../../../../_static/images/zcan.svg" border="0" style="position:static"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version zcansdk">
        <a href="../../../../../zcansdk/index.html">ZCAN IOT SDK</a>
      </div>
      
      <div class="rst-other-version zcanxlib">
        <a href="../../../../../zcanxlib/README.html">ZCAN Xlib</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version sof">
        <a href="../../../../../sof/index.html">SOF</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>