

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Application/software image management group &mdash; Zephyr Project Documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/zephyr.css" type="text/css" />

  
  

  
  

  

  
  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-210766333-2"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
  <script type="text/javascript" src="../../../_static/js/zcaniot.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="Statistics management" href="smp_group_2.html" />
    <link rel="prev" title="Default/OS Management Group" href="smp_group_0.html" />
  <link rel="shortcut icon" href="../../../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Zephyr Project
          

          
          </a>

          
            
            
              <div class="version">
                3.0.99
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">User and Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../beyond-GSG.html">Beyond the Getting Started Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../arch/index.html">Architecture-related Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/index.html">Documentation Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code-relocation.html">Code And Data Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flash_debug/index.html">Flashing and Hardware Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debug_tools/index.html">Debugging and Tracing</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Device Management</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../mcumgr.html">MCUmgr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mcumgr_backporting.html">Fixing and backporting fixes to Zephyr v2.7 MCUmgr</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../smp_protocol.html">SMP Protocol Specification</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../smp_protocol.html#frame-the-envelope">Frame: The envelope</a></li>
<li class="toctree-l4"><a class="reference internal" href="../smp_protocol.html#minimal-response">Minimal response</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../smp_protocol.html#specifications-of-management-groups-supported-by-zephyr">Specifications of management groups supported by Zephyr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dfu.html">Device Firmware Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ota.html">Over-the-Air Update</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dts/index.html">Devicetree Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../env_vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../emulator/index.html">Peripheral and Hardware Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html">Modules (External projects)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platformio/index.html">Using with PlatformIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../portability/index.html">OS Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../porting/index.html">Porting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../smf/index.html">State Machine Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../test/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm/index.html">Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../west/index.html">West (Zephyr’s meta-tool)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../optimizations/index.html">Optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zephyr_cmake_package.html">Zephyr CMake Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">User and Developer Guides</a> &raquo;</li>
        
          <li><a href="../index.html">Device Management</a> &raquo;</li>
        
          <li><a href="../smp_protocol.html">SMP Protocol Specification</a> &raquo;</li>
        
      <li>Application/software image management group</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/guides/device_mgmt/smp_groups/smp_group_1.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="application-software-image-management-group">
<span id="mcumgr-smp-group-1"></span><h1>Application/software image management group<a class="headerlink" href="#application-software-image-management-group" title="Permalink to this headline">¶</a></h1>
<p>Application/software image management management group defines following commands:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p>Command description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>State of images</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p>Image upload</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p>File
(reserved but not supported by Zephyr)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p>Corelist
(reserved but not supported by Zephyr)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">4</span></code></p></td>
<td><p>Coreload
(reserved but not supported by Zephyr)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">5</span></code></p></td>
<td><p>Image erase</p></td>
</tr>
</tbody>
</table>
<div class="section" id="notion-of-slots-and-images-in-zephyr">
<h2>Notion of “slots” and “images” in Zephyr<a class="headerlink" href="#notion-of-slots-and-images-in-zephyr" title="Permalink to this headline">¶</a></h2>
<p>The “slot” and “image” definition comes from mcuboot where “image” would
consist of two “slots”, further named “primary” and “secondary”; the application
is supposed to run from the “primary slot” and update is supposed to be
uploaded to the “secondary slot”;  the mcuboot is responsible in swapping
slots on boot.
This means that pair of slots is dedicated to single upgradable application.
In case of Zephyr this gets a little bit confusing because DTS will use
“slot0_partition” and “slot1_partition”, as label of <code class="docutils literal notranslate"><span class="pre">fixed-partition</span></code> dedicated
to single application, but will name them as “image-0” and “image-1” respectively.</p>
<p>Currently Zephyr supports at most two images, in which case mapping is as follows:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 28%" />
<col style="width: 40%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Image</p></th>
<th class="head"><p>Slot labels</p></th>
<th class="head"><p>Slot  Names</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>“slot0_partition”
“slot1_partition”</p></td>
<td><p>“image-0”
“image-1”</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>“slot2_partition”
“slot3_partition”</p></td>
<td><p>“image-2”
“image-3”</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="state-of-images">
<h2>State of images<a class="headerlink" href="#state-of-images" title="Permalink to this headline">¶</a></h2>
<p>The command is used to set state of images and obtain list of images
with their current state.</p>
<div class="section" id="get-state-of-images-request">
<h3>Get state of images request<a class="headerlink" href="#get-state-of-images-request" title="Permalink to this headline">¶</a></h3>
<p>Get state of images request header fields:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
</tbody>
</table>
<p>The command sends sends empty CBOR map as data.</p>
</div>
<div class="section" id="get-state-of-images-response">
<span id="mcumgr-smp-protocol-op-1-grp-1-cmd-0"></span><h3>Get state of images response<a class="headerlink" href="#get-state-of-images-response" title="Permalink to this headline">¶</a></h3>
<p>Get state of images response header fields:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Below definition of the response contains “image” field that has been marked
as optional(opt): the field may not appear in response when target application
does not support more than one image. The field is mandatory when application
supports more than one application image to allow identifying which image
information is listed.</p>
</div>
<p>A response will only contain information for valid images, if an image can not
be identified as valid it is simply skipped.</p>
<p>CBOR data of successful response:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    (str)&quot;images&quot; : [
        {
            (str,opt)&quot;image&quot;        : (int)
            (str)&quot;slot&quot;             : (int)
            (str)&quot;version&quot;          : (str)
            (str)&quot;hash&quot;             ; (str)
            (str,opt)&quot;bootable&quot;     : (bool)
            (str,opt)&quot;pending&quot;      : (bool)
            (str,opt)&quot;confirmed&quot;    : (bool)
            (str,opt)&quot;active&quot;       : (bool)
            (str,opt)&quot;permanent&quot;    : (bool)
        }
        ...
    ]
    (str,opt)&quot;splitStatus&quot; : (int)
}
</pre></div>
</div>
<p>In case of error the CBOR data takes form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    (str)&quot;rc&quot; : (int)
    (str,opt)&quot;rsn&quot; : (str)
}
</pre></div>
</div>
<p>where:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>“image”</p></td>
<td><p>semi-optional image number; the field is not
required when only one image is supported by
running application</p></td>
</tr>
<tr class="row-even"><td><p>“slot”</p></td>
<td><p>slot number within “image”; each image has two
slots : primary (running one) = 0 and secondary
(for DFU dual-bank purposes) = 1</p></td>
</tr>
<tr class="row-odd"><td><p>“version”</p></td>
<td><p>string representing image version, as set with
<code class="docutils literal notranslate"><span class="pre">imgtool</span></code></p></td>
</tr>
<tr class="row-even"><td><p>“hash”</p></td>
<td><p>hash of an upload; this is used to identify
an upload session, for example to allow mcumgr
library to continue broken session</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default mcumgr-cli uses here a few
characters of sha256 of the first uploaded
chunk.</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>“bootable”</p></td>
<td><p>true if image has bootable flag set;
this field does not have to be present if false</p></td>
</tr>
<tr class="row-even"><td><p>“pending”</p></td>
<td><p>true if image is set for next swap
this field does not have to be present if false</p></td>
</tr>
<tr class="row-odd"><td><p>“confirmed”</p></td>
<td><p>true if image has been confirmed
this field does not have to be present if false</p></td>
</tr>
<tr class="row-even"><td><p>“active”</p></td>
<td><p>true if image is currently active application
this field does not have to be present if false</p></td>
</tr>
<tr class="row-odd"><td><p>“permanent”</p></td>
<td><p>true if image is to stay in primary slot after
next boot
this field does not have to be present if false</p></td>
</tr>
<tr class="row-even"><td><p>“splitStatus”</p></td>
<td><p>states whether loader of split image is compatible
with application part; this is unused by Zephyr</p></td>
</tr>
<tr class="row-odd"><td><p>“rc”</p></td>
<td><p><a class="reference internal" href="../smp_protocol.html#mcumgr-smp-protocol-status-codes"><span class="std std-ref">Status/error codes in responses</span></a></p></td>
</tr>
<tr class="row-even"><td><p>“rsn”</p></td>
<td><p>optional string that clarifies reason for an
error; specifically useful for error code <code class="docutils literal notranslate"><span class="pre">1</span></code>,
unknown error</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more information on how does image/slots function, please refer to
the MCUBoot documentation
<a class="reference external" href="https://www.mcuboot.com/documentation/design/#image-slots">https://www.mcuboot.com/documentation/design/#image-slots</a></p>
</div>
</div>
<div class="section" id="set-state-of-image-request">
<h3>Set state of image request<a class="headerlink" href="#set-state-of-image-request" title="Permalink to this headline">¶</a></h3>
<p>Set state of image request header fields:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
</tbody>
</table>
<p>CBOR data of request:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    {
        (str,opt)&quot;hash&quot;     : (str)
        (str)&quot;confirm&quot;      : (bool)
    }
}
</pre></div>
</div>
<p>If “confirm” is false an image with the “hash” will be set for test, which means
that it will not be marked as permanent and upon hard reset the previous
application will be restored to the primary slot.
In case when “confirm” is true, the “hash” is optional as the currently running
application will be assumed as target for confirmation.</p>
</div>
<div class="section" id="set-state-of-image-response">
<h3>Set state of image response<a class="headerlink" href="#set-state-of-image-response" title="Permalink to this headline">¶</a></h3>
<p>The response takes the same format as <a class="reference internal" href="#mcumgr-smp-protocol-op-1-grp-1-cmd-0"><span class="std std-ref">Get state of images response</span></a></p>
</div>
</div>
<div class="section" id="image-upload">
<h2>Image upload<a class="headerlink" href="#image-upload" title="Permalink to this headline">¶</a></h2>
<p>The image upload command allows to update application image.</p>
<div class="section" id="image-upload-request">
<h3>Image upload request<a class="headerlink" href="#image-upload-request" title="Permalink to this headline">¶</a></h3>
<p>The image upload request is sent for each chunk of image that is uploaded, until
complete image gets uploaded to a device.</p>
<p>Set state of image request header fields:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
</tr>
</tbody>
</table>
<p>CBOR data of request:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    {
        (str,opt)&quot;image&quot;    : (uint)
        (str,opt)&quot;len&quot;      : (uint)
        (str)&quot;off&quot;          : (uint)
        (str,opt)&quot;sha&quot;      : (str)
        (str,opt)&quot;data&quot;     : (byte str)
        (str,opt)&quot;upgrade&quot;  : (bool)
    }
}
</pre></div>
</div>
<p>where:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>“image”</p></td>
<td><p>optional image number, it does not have to appear
in request at all, in which case it is assumed to
be 0; only request with “off” 0 can contain
image number</p></td>
</tr>
<tr class="row-even"><td><p>“len”</p></td>
<td><p>optional length of an image, it only appears in
the first packet of request, where “off” is 0</p></td>
</tr>
<tr class="row-odd"><td><p>“off”</p></td>
<td><p>offset of image chunk the request carries</p></td>
</tr>
<tr class="row-even"><td><p>“sha”</p></td>
<td><p>string identifying update session; it should only
be present if “off” is zero; although name
suggests it might be SHA, it can actually be any
string</p></td>
</tr>
<tr class="row-odd"><td><p>“data”</p></td>
<td><p>optional image data</p></td>
</tr>
<tr class="row-even"><td><p>“upgrade”</p></td>
<td><p>optional flag that states that only upgrade
should be allowed, so if version of uploaded
software is lower then already on device, the
image update should be rejected
(unused by Zephyr at this time)</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is no field representing size of chunk that is carried as “data” because
that information is embedded within “data” field itself.</p>
</div>
<p>The mcumgr library uses “sha” field to tag ongoing update session, to be able
to continue it in case when it gets broken.
If library gets request with “off” equal zero it checks stored “sha” within its
state and if it matches it will respond to update client application with
offset that it should continue with.</p>
</div>
<div class="section" id="image-upload-response">
<h3>Image upload response<a class="headerlink" href="#image-upload-response" title="Permalink to this headline">¶</a></h3>
<p>Set state of image request header fields:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
</tr>
</tbody>
</table>
<p>CBOR data of response:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    (str,opt)&quot;off&quot;  : (uint)
    (str)&quot;rc&quot;       : (int)
    (str,opt)&quot;rsn&quot;  : (str)
}
</pre></div>
</div>
<p>where:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>“off”</p></td>
<td><p>offset of last successfully written byte of update</p></td>
</tr>
<tr class="row-even"><td><p>“rc”</p></td>
<td><p><a class="reference internal" href="../smp_protocol.html#mcumgr-smp-protocol-status-codes"><span class="std std-ref">Status/error codes in responses</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>“rsn”</p></td>
<td><p>Optional string that clarifies reason for an
error; specifically useful for error code <code class="docutils literal notranslate"><span class="pre">1</span></code>,
unknown error</p></td>
</tr>
</tbody>
</table>
<p>The “off” field is only included in responses to successfully processed requests;
if “rc” is negative the “off’ may not appear.</p>
</div>
</div>
<div class="section" id="image-erase">
<h2>Image erase<a class="headerlink" href="#image-erase" title="Permalink to this headline">¶</a></h2>
<p>The command is used for erasing image slot on a target device.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently Zephyr version of mcumgr is hardcoded to always erase secondary slot
of the first image.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is synchronous command which means that a sender of request will not
receive response until the command completes.</p>
</div>
<div class="section" id="image-erase-request">
<h3>Image erase request<a class="headerlink" href="#image-erase-request" title="Permalink to this headline">¶</a></h3>
<p>Image erase request header fields:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">5</span></code></p></td>
</tr>
</tbody>
</table>
<p>The command sends sends empty CBOR map as data.</p>
</div>
<div class="section" id="image-erase-response">
<h3>Image erase response<a class="headerlink" href="#image-erase-response" title="Permalink to this headline">¶</a></h3>
<p>Image erase response header fields:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">5</span></code></p></td>
</tr>
</tbody>
</table>
<p>CBOR data of response:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    (str)&quot;rc&quot;       : (int)
    (str,opt)&quot;rsn&quot;  : (str)
}
</pre></div>
</div>
<p>where:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>“rc”</p></td>
<td><p><a class="reference internal" href="../smp_protocol.html#mcumgr-smp-protocol-status-codes"><span class="std std-ref">Status/error codes in responses</span></a></p></td>
</tr>
<tr class="row-even"><td><p>“rsn”</p></td>
<td><p>Optional string that clarifies reason for an
error; specifically useful for error code <code class="docutils literal notranslate"><span class="pre">1</span></code>,
unknown error</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Response from Zephyr running device may have “rc” value of 6, bad state
(<a class="reference internal" href="../smp_protocol.html#mcumgr-smp-protocol-status-codes"><span class="std std-ref">Status/error codes in responses</span></a>), which means that the secondary
image has been marked for next boot already and may not be erased.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="smp_group_2.html" class="btn btn-neutral float-right" title="Statistics management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="smp_group_0.html" class="btn btn-neutral" title="Default/OS Management Group" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; <a href="../../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      Last updated on May 10, 2022.

    </p>
</td>
<td id="zcanlogo">
  <a href="https://www.unisim-micro.com/"><img src="../../../_static/images/zcan.svg" border="0" style="position:static"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version zcansdk">
        <a href="../../../../zcansdk/index.html">ZCAN IOT SDK</a>
      </div>
      
      <div class="rst-other-version zcanxlib">
        <a href="../../../../zcanxlib/README.html">ZCAN Xlib</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version sof">
        <a href="../../../../sof/index.html">SOF</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>