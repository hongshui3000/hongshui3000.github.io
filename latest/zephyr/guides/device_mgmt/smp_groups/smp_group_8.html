

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>File management &mdash; Zephyr Project Documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/zephyr.css" type="text/css" />

  
  

  
  

  

  
  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-210766333-2"></script>
        <script src="../../../_static/js/ga-tracker.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
  <script type="text/javascript" src="../../../_static/js/zcaniot.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="next" title="Shell management" href="smp_group_9.html" />
    <link rel="prev" title="Statistics management" href="smp_group_2.html" />
  <link rel="shortcut icon" href="../../../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Zephyr Project
          

          
          </a>

          
            
            
              <div class="version">
                3.0.99
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">User and Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../beyond-GSG.html">Beyond the Getting Started Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../arch/index.html">Architecture-related Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/index.html">Documentation Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code-relocation.html">Code And Data Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crypto/index.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flash_debug/index.html">Flashing and Hardware Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debug_tools/index.html">Debugging and Tracing</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Device Management</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../mcumgr.html">MCUmgr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mcumgr_backporting.html">Fixing and backporting fixes to Zephyr v2.7 MCUmgr</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../smp_protocol.html">SMP Protocol Specification</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../smp_protocol.html#frame-the-envelope">Frame: The envelope</a></li>
<li class="toctree-l4"><a class="reference internal" href="../smp_protocol.html#minimal-response">Minimal response</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../smp_protocol.html#specifications-of-management-groups-supported-by-zephyr">Specifications of management groups supported by Zephyr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dfu.html">Device Firmware Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ota.html">Over-the-Air Update</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dts/index.html">Devicetree Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../env_vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../emulator/index.html">Peripheral and Hardware Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules.html">Modules (External projects)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platformio/index.html">Using with PlatformIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../portability/index.html">OS Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../porting/index.html">Porting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../smf/index.html">State Machine Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../test/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tfm/index.html">Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../west/index.html">West (Zephyr’s meta-tool)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../optimizations/index.html">Optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zephyr_cmake_package.html">Zephyr CMake Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zephyr Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">User and Developer Guides</a> &raquo;</li>
        
          <li><a href="../index.html">Device Management</a> &raquo;</li>
        
          <li><a href="../smp_protocol.html">SMP Protocol Specification</a> &raquo;</li>
        
      <li>File management</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/guides/device_mgmt/smp_groups/smp_group_8.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="file-management">
<span id="mcumgr-smp-group-8"></span><h1>File management<a class="headerlink" href="#file-management" title="Permalink to this headline">¶</a></h1>
<p>The file management group provides commands that allow to upload and download files
to/from a device.</p>
<p>File management group defines following commands:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p>Command description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>File download/upload</p></td>
</tr>
</tbody>
</table>
<div class="section" id="file-download">
<h2>File download<a class="headerlink" href="#file-download" title="Permalink to this headline">¶</a></h2>
<p>Command allows to download contents of an existing file from specified path
of a target device. The command is stateless and mcumgr does not hold file
in open state after response to the command is issued, instead a client
application is supposed to keep track of data it has already downloaded,
and issue subsequent requests, with modified offset, to gather entire file.
Request does not carry size of requested chunk, the size is specified
by application itself.
Mcumgr server side re-opens a file for each subsequent request, and current
specification does not provide means to identify subsequent requests as
belonging to specified download session. This means that the file is not
locked in any way or exclusively owned by mcumgr, for the time of download
session, and may change between requests or even be removed.</p>
<div class="section" id="file-download-request">
<h3>File download request<a class="headerlink" href="#file-download-request" title="Permalink to this headline">¶</a></h3>
<p>File download request header:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
</tbody>
</table>
<p>CBOR data of request:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    (str)&quot;off&quot; :  (uint)
    (str)&quot;name&quot; : (str)
}
</pre></div>
</div>
<p>where:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>“off”</p></td>
<td><p>offset to start download at</p></td>
</tr>
<tr class="row-even"><td><p>“name”</p></td>
<td><p>absolute path to a file</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="file-download-response">
<h3>File download response<a class="headerlink" href="#file-download-response" title="Permalink to this headline">¶</a></h3>
<p>File download response header:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
</tbody>
</table>
<p>CBOR data of successful response:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    (str)&quot;off&quot;      : (uint)
    (str)&quot;data&quot;     : (byte str)
    (str)&quot;rc&quot;       : (int)
    (str,opt)&quot;len&quot;  : (uint)
}
</pre></div>
</div>
<p>In case of error the CBOR data takes form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    (str)&quot;rc&quot;           : (int)
}
</pre></div>
</div>
<p>where:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>“off”</p></td>
<td><p>offset the response is for</p></td>
</tr>
<tr class="row-even"><td><p>“data”</p></td>
<td><p>chunk of data read from file; it is CBOR encoded
stream of bytes with embeeded size;
“data” appears only in responses where “rc” is 0</p></td>
</tr>
<tr class="row-odd"><td><p>“len”</p></td>
<td><p>length of file, this field is only mandatory
when “off” is 0</p></td>
</tr>
<tr class="row-even"><td><p>“rc”</p></td>
<td><p><a class="reference internal" href="../smp_protocol.html#mcumgr-smp-protocol-status-codes"><span class="std std-ref">Status/error codes in responses</span></a></p></td>
</tr>
</tbody>
</table>
<p>In case when “rc” is not 0, success, the other fields will not appear.</p>
</div>
</div>
<div class="section" id="file-upload">
<h2>File upload<a class="headerlink" href="#file-upload" title="Permalink to this headline">¶</a></h2>
<p>Allows to upload a file to a specified location. Command will automatically overwrite
existing file or create a new one if it does not exist at specified path.
The protocol supports stateless upload where each requests carries different chunk
of a file and it is client side responsibility to track progress of upload.</p>
<p>Mcumgr server side re-opens a file for each subsequent request, and current
specification does not provide means to identify subsequent requests as
belonging to specified upload session. This means that the file is not
locked in any way or exclusively owned by mcumgr, for the time of upload
session, and may change between requests or even be removed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Weirdly, the current Zephyr implementation is half-stateless as is able to hold
single upload context, holding information on ongoing upload, that consists
of bool flag indicating in-progress upload, last successfully uploaded offset
and total length only.</p>
</div>
<div class="section" id="file-upload-request">
<h3>File upload request<a class="headerlink" href="#file-upload-request" title="Permalink to this headline">¶</a></h3>
<p>File upload request header:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
</tbody>
</table>
<p>CBOR data of request:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    (str)&quot;off&quot;      : (uint)
    (str)&quot;data&quot;     : (str)
    (str)&quot;name&quot;     : (str)
    (str,opt)&quot;len&quot;  : (uint)
}
</pre></div>
</div>
<p>where:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>“off”</p></td>
<td><p>offset to start/continue uplad  at</p></td>
</tr>
<tr class="row-even"><td><p>“data”</p></td>
<td><p>chunk of data to write to the file;
it is CBOR encoded with length embeeded</p></td>
</tr>
<tr class="row-odd"><td><p>“name”</p></td>
<td><p>absolute path to a file</p></td>
</tr>
<tr class="row-even"><td><p>“len”</p></td>
<td><p>length of file, this field is only mandatory
when “off” is 0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="file-upload-response">
<h3>File upload response<a class="headerlink" href="#file-upload-response" title="Permalink to this headline">¶</a></h3>
<p>File upload response header:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 21%" />
<col style="width: 37%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">OP</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Group</span> <span class="pre">ID</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">Command</span> <span class="pre">ID</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">8</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
</tbody>
</table>
<p>CBOR data of request:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    (str,opt)&quot;off&quot;      : (uint)
    (str)&quot;rc&quot;           : (int)
}
</pre></div>
</div>
<p>where:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>“off”</p></td>
<td><p>offset of last successfully written data;
appears only when “rc” is 0</p></td>
</tr>
<tr class="row-even"><td><p>“rc”</p></td>
<td><p><a class="reference internal" href="../smp_protocol.html#mcumgr-smp-protocol-status-codes"><span class="std std-ref">Status/error codes in responses</span></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="smp_group_9.html" class="btn btn-neutral float-right" title="Shell management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="smp_group_2.html" class="btn btn-neutral" title="Statistics management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; <a href="../../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      Last updated on May 10, 2022.

    </p>
</td>
<td id="zcanlogo">
  <a href="https://www.unisim-micro.com/"><img src="../../../_static/images/zcan.svg" border="0" style="position:static"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version zcansdk">
        <a href="../../../../zcansdk/index.html">ZCAN IOT SDK</a>
      </div>
      
      <div class="rst-other-version zcanxlib">
        <a href="../../../../zcanxlib/README.html">ZCAN Xlib</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version sof">
        <a href="../../../../sof/index.html">SOF</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>