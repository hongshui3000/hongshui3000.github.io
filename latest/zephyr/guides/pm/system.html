

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>System Power Management &mdash; Zephyr Project Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/zephyr.css" type="text/css" />

  
  

  
  

  

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-210766333-2"></script>
        <script src="../../_static/js/ga-tracker.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
  <script type="text/javascript" src="../../_static/js/zcaniot.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Device Power Management Infrastructure" href="device.html" />
    <link rel="prev" title="Overview" href="overview.html" />
  <link rel="shortcut icon" href="../../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Zephyr Project
          

          
          </a>

          
            
            
              <div class="version">
                3.0.99
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development_process/index.html">Development and Contribution Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/index.html">Build and Configuration Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/index.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User and Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../beyond-GSG.html">Beyond the Getting Started Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch/index.html">Architecture-related Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docs/index.html">Documentation Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../coccinelle.html">Coccinelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code-relocation.html">Code And Data Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto/index.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flash_debug/index.html">Flashing and Hardware Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debug_tools/index.html">Debugging and Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_mgmt/index.html">Device Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dts/index.html">Devicetree Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../env_vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pinctrl/index.html">Pin Control</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Power Management</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">System Power Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#power-states">Power States</a></li>
<li class="toctree-l4"><a class="reference internal" href="#power-states-constraint">Power States Constraint</a></li>
<li class="toctree-l4"><a class="reference internal" href="#power-management-policies">Power Management Policies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="device.html">Device Power Management Infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="device_runtime.html">Device Runtime Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="power_domain.html">Power Domain</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../emulator/index.html">Peripheral and Hardware Emulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules (External projects)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platformio/index.html">Using with PlatformIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../portability/index.html">OS Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../porting/index.html">Porting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../smf/index.html">State Machine Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm/index.html">Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../west/index.html">West (Zephyr’s meta-tool)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimizations/index.html">Optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zephyr_cmake_package.html">Zephyr CMake Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/index.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Zephyr Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">User and Developer Guides</a> &raquo;</li>
        
          <li><a href="index.html">Power Management</a> &raquo;</li>
        
      <li>System Power Management</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/guides/pm/system.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="system-power-management">
<h1>System Power Management<a class="headerlink" href="#system-power-management" title="Permalink to this headline">¶</a></h1>
<p>The kernel enters the idle state when it has nothing to schedule. If enabled via
the <a class="reference internal" href="../../kconfig.html#CONFIG_PM" title="CONFIG_PM"><code class="xref kconfig kconfig-option docutils literal notranslate"><span class="pre">CONFIG_PM</span></code></a> Kconfig option, the Power Management
Subsystem can put an idle system in one of the supported power states, based
on the selected power management policy and the duration of the idle time
allotted by the kernel.</p>
<p>It is an application responsibility to set up a wake up event. A wake up event
will typically be an interrupt triggered by one of the SoC peripheral modules
such as a SysTick, RTC, counter, or GPIO. Depending on the power mode entered,
only some SoC peripheral modules may be active and can be used as a wake up
source.</p>
<p>The following diagram describes system power management:</p>
<img alt="System power management" class="align-center" src="../../_images/system-pm.svg" /><p>Some handful examples using different power management features:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://gitee.com/ZCAN-IOT/zephyr/blob/main/samples/boards/stm32/power_mgmt/blinky/">samples/boards/stm32/power_mgmt/blinky/</a></p></li>
<li><p><a class="reference external" href="https://gitee.com/ZCAN-IOT/zephyr/blob/main/samples/boards/nrf/system_off/">samples/boards/nrf/system_off/</a></p></li>
<li><p><a class="reference external" href="https://gitee.com/ZCAN-IOT/zephyr/blob/main/samples/subsys/pm/device_pm/">samples/subsys/pm/device_pm/</a></p></li>
<li><p><a class="reference external" href="https://gitee.com/ZCAN-IOT/zephyr/blob/main/tests/subsys/pm/power_mgmt/">tests/subsys/pm/power_mgmt/</a></p></li>
<li><p><a class="reference external" href="https://gitee.com/ZCAN-IOT/zephyr/blob/main/tests/subsys/pm/power_mgmt_soc/">tests/subsys/pm/power_mgmt_soc/</a></p></li>
<li><p><a class="reference external" href="https://gitee.com/ZCAN-IOT/zephyr/blob/main/tests/subsys/pm/power_state_api/">tests/subsys/pm/power_state_api/</a></p></li>
</ul>
<div class="section" id="power-states">
<h2>Power States<a class="headerlink" href="#power-states" title="Permalink to this headline">¶</a></h2>
<p>The power management subsystem contains a set of states based on
power consumption and context retention.</p>
<p>The list of available power states is defined by <a class="reference internal" href="../../reference/pm/index.html#c.pm_state" title="pm_state"><code class="xref c c-enum docutils literal notranslate"><span class="pre">pm_state</span></code></a>. In
general power states with higher indexes will offer greater power savings and
have higher wake latencies.</p>
</div>
<div class="section" id="power-states-constraint">
<span id="pm-constraints"></span><h2>Power States Constraint<a class="headerlink" href="#power-states-constraint" title="Permalink to this headline">¶</a></h2>
<p>The power management subsystem allows different Zephyr components and
applications to set constraints on various power states preventing the
system from transitioning into these states. This can be used by devices when
executing tasks in background to prevent the system from going to a specific
state where it would lose context. Constraints can be set using the
<a class="reference internal" href="../../reference/pm/index.html#c.pm_constraint_set" title="pm_constraint_set"><code class="xref c c-func docutils literal notranslate"><span class="pre">pm_constraint_set()</span></code></a>, released using <a class="reference internal" href="../../reference/pm/index.html#c.pm_constraint_release" title="pm_constraint_release"><code class="xref c c-func docutils literal notranslate"><span class="pre">pm_constraint_release()</span></code></a> and
checked using the <a class="reference internal" href="../../reference/pm/index.html#c.pm_constraint_get" title="pm_constraint_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">pm_constraint_get()</span></code></a>.</p>
</div>
<div class="section" id="power-management-policies">
<h2>Power Management Policies<a class="headerlink" href="#power-management-policies" title="Permalink to this headline">¶</a></h2>
<p>The power management subsystem supports the following power management policies:</p>
<ul class="simple">
<li><p>Residency based</p></li>
<li><p>Application defined</p></li>
</ul>
<p>The policy manager is responsible for informing the power subsystem which
power state the system should transition to based on states defined by the
platform and possible runtime <a class="reference internal" href="#pm-constraints"><span class="std std-ref">constraints</span></a></p>
<p>More details on the states definition can be found in the
<a class="reference internal" href="../../reference/devicetree/bindings/power/zephyr%2Cpower-state.html#std-dtcompatible-zephyr-power-state"><code class="xref std std-dtcompatible docutils literal notranslate"><span class="pre">zephyr,power-state</span></code></a> binding documentation.</p>
<div class="section" id="residency">
<h3>Residency<a class="headerlink" href="#residency" title="Permalink to this headline">¶</a></h3>
<p>The power management system enters the power state which offers the highest
power savings, and with a minimum residency value (see
<a class="reference internal" href="../../reference/devicetree/bindings/power/zephyr%2Cpower-state.html#std-dtcompatible-zephyr-power-state"><code class="xref std std-dtcompatible docutils literal notranslate"><span class="pre">zephyr,power-state</span></code></a>) less than or equal to the scheduled system
idle time duration.</p>
<p>This policy also accounts for the time necessary to become active
again. The core logic used by this policy to select the best power
state is:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">time_to_next_scheduled_event</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">min_residency_us</span> <span class="o">+</span> <span class="n">state</span><span class="p">.</span><span class="n">exit_latency</span><span class="p">)))</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">state</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="application">
<h3>Application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h3>
<p>The application defines the power management policy by implementing the
<code class="xref c c-func docutils literal notranslate"><span class="pre">pm_policy_next_state()</span></code> function. In this policy the application is free
to decide which power state the system should transition to based on the
remaining time for the next scheduled timeout.</p>
<p>An example of an application that defines its own policy can be found in
<a class="reference external" href="https://gitee.com/ZCAN-IOT/zephyr/blob/main/tests/subsys/pm/power_mgmt/">tests/subsys/pm/power_mgmt/</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="device.html" class="btn btn-neutral float-right" title="Device Power Management Infrastructure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; <a href="../../copyright.html">Copyright</a> 2015-2022 Zephyr Project members and individual contributors.
      Last updated on May 10, 2022.

    </p>
</td>
<td id="zcanlogo">
  <a href="https://www.unisim-micro.com/"><img src="../../_static/images/zcan.svg" border="0" style="position:static"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Zephyr Project</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version zcansdk">
        <a href="../../../zcansdk/index.html">ZCAN IOT SDK</a>
      </div>
      
      <div class="rst-other-version zcanxlib">
        <a href="../../../zcanxlib/README.html">ZCAN Xlib</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version sof">
        <a href="../../../sof/index.html">SOF</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>