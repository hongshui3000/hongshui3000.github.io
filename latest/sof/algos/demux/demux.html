

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Multiplexer/Demultiplexer &mdash; SOF Project 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/sof.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
  <script type="text/javascript" src="../../_static/js/zcaniot.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Time Domain Fixed Beamformer (TDFB)" href="../tdfb/time_domain_fixed_beamformer.html" />
    <link rel="prev" title="Sample Rate Conversion" href="../src/sample_rate_conversion.html" />
  <link rel="shortcut icon" href="../../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> SOF Project
          

          
            
            <img src="../../_static/logo_sof_white_200w.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://sofproject.org">SOF project website</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction to the SOF Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architectures/index.html">Supported Architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/index.html">Platforms</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Algorithms</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#supplied-processing-algorithms">Supplied Processing Algorithms</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#algorithm-specific-information">Algorithm Specific Information</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../src/sample_rate_conversion.html">Sample Rate Conversion</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Multiplexer/Demultiplexer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tdfb/time_domain_fixed_beamformer.html">Time Domain Fixed Beamformer (TDFB)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guides/index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release.html">Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contributing to the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tsc/index.html">Technical Steering Committee (TSC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainers/index.html">SOF admin, maintainers and code owners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentations/index.html">Presentations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SOF Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Algorithms</a> &raquo;</li>
        
      <li>Multiplexer/Demultiplexer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/algos/demux/demux.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="multiplexer-demultiplexer">
<span id="demux"></span><h1>Multiplexer/Demultiplexer<a class="headerlink" href="#multiplexer-demultiplexer" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The multiplexer/demultiplexer component copies its input audio channels
into output audio channels according to a specific routing
matrix. Multiplexer has multiple input audio streams and a single
audio output stream. Demultiplexer has a single input stream and
multiple output streams. In the SOF codebase, multiplexer and demultiplexer
are implemented in a single component as the operations and
configurations overlap heavily.</p>
<div class="figure align-default" id="id1">
<img alt="../../_images/muxdemux.png" src="../../_images/muxdemux.png" />
<p class="caption"><span class="caption-number">Figure 19 </span><span class="caption-text">Multiplexer has exactly 1 output stream and demultiplexer has exactly
1 input stream.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>The component configuration defines how audio channels are copied from
input to output streams. As the ASoC/SOF audio stream can have up to 8
audio channels, a stream-to-stream specific 8x8 routing matrix
defines the channel mapping from input to output. Because every stream
is fully configurable, we have a matrix for all multiplexer input
streams or all demultiplexer output streams. The 8x8 binary matrix takes up
to 64 bits and is controlled with eight unsigned char values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The mux/demux component can’t mix channels. If you try to set up mixing in the configuration matrix, you will get an error in the component initialization phase.</p>
</div>
<div class="figure align-default" id="id2">
<img alt="../../_images/mux.png" src="../../_images/mux.png" />
<p class="caption"><span class="caption-number">Figure 20 </span><span class="caption-text">Example of multiplexer configuration matrices with 2 input streams.
In this artificial mux example, the first input stream’s channel 1 is copied to the output stream’s channel 1. The second input stream’s channel 2 is copied to the output stream’s channel 2. If the streams have only 2 channels, the matrix values outside the 2x2 square don’t have any effect.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id3">
<img alt="../../_images/demux.png" src="../../_images/demux.png" />
<p class="caption"><span class="caption-number">Figure 21 </span><span class="caption-text">Example of demultiplexer configuration matrices with 2 output streams.
In this artificial demux example, the input stream’s channel 1 is copied to both channels of the first output stream and the input stream’s channel 2 is copied to both channels of the second output stream.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The demux matrix configuration is opposite to the mux configuration: the input channel is the matrix column and the output is the row.</p>
</div>
</div>
<div class="section" id="topology">
<h3>Topology<a class="headerlink" href="#topology" title="Permalink to this headline">¶</a></h3>
<p>Previous figures show that the routing matrix is difficult to
parametrize in order to be easily understandable. As it is sent to firmware
with 64 bits, it is quite tedious to easily see the binary routings from
hexadecimal or integer values. SOF topology m4 macros have helpers to
“visualize” the matrix for easier configuration.</p>
<p>The following example from pipe-volume-demux-playback.m4 shows how to define
2 routing matrices and a demux component:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># pipeline_id, channels, matrix_rows
define(matrix1, `ROUTE_MATRIX(PIPELINE_ID, 2,
                             `BITS_TO_BYTE(1, 0, 0 ,0 ,0 ,0 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 1, 0 ,0 ,0 ,0 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 1 ,0 ,0 ,0 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 0 ,1 ,0 ,0 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 0 ,0 ,1 ,0 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 0 ,0 ,0 ,1 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 0 ,0 ,0 ,0 ,1 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 0 ,0 ,0 ,0 ,0 ,1)&#39;)&#39;)

# pipeline_id, channels, matrix_rows
define(matrix2, `ROUTE_MATRIX(5, 2,
                             `BITS_TO_BYTE(1, 0, 0 ,0 ,0 ,0 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 1, 0 ,0 ,0 ,0 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 1 ,0 ,0 ,0 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 0 ,1 ,0 ,0 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 0 ,0 ,1 ,0 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 0 ,0 ,0 ,1 ,0 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 0 ,0 ,0 ,0 ,1 ,0)&#39;,
                             `BITS_TO_BYTE(0, 0, 0 ,0 ,0 ,0 ,0 ,1)&#39;)&#39;)

# frame_format, num_channels, num_streams, route_matrix
MUXDEMUX_CONFIG(demux_priv, 2, 2, 2, LIST(`     &#39;, `matrix1,&#39;, `matrix2&#39;))

# demux Bytes control with max value of 255
C_CONTROLBYTES(DEMUX, PIPELINE_ID,
        CONTROLBYTES_OPS(bytes, 258 binds the mixer control to bytes get/put handlers, 258, 258),
        CONTROLBYTES_EXTOPS(258 binds the mixer control to bytes get/put handlers, 258, 258),
        , , ,
        CONTROLBYTES_MAX(, 304),
        ,
        demux_priv)

# Mux 0 has 2 sink and source periods.
W_MUXDEMUX(0, 1, PIPELINE_FORMAT, 2, 2, LIST(`         &#39;, &quot;DEMUX&quot;))
</pre></div>
</div>
<p>In the above example you can see that the routing matrices have only
“diagonal” 1’s, which means that input stream’s channels are copied to
corresponding output streams channels.</p>
</div>
<div class="section" id="alsa-control">
<h3>ALSA control<a class="headerlink" href="#alsa-control" title="Permalink to this headline">¶</a></h3>
<p>Multiplexer configuration is loaded in the kernel/firmware boot as part of
the ALSA binary control in topology, but can be also controlled through ALSA
controls.</p>
<p>The complex binary control blob can be created with a generic
python tool:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">sof_gen_blob</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a</span> <span class="mi">3</span> <span class="mi">14</span> <span class="mi">0</span> <span class="o">-</span><span class="n">t</span> <span class="mi">18</span> <span class="o">-</span><span class="n">m</span> <span class="mi">3</span><span class="n">H</span> <span class="n">I</span> <span class="mi">1</span><span class="n">B</span> <span class="mi">8</span><span class="n">B</span> <span class="mi">3</span><span class="n">B</span> <span class="n">I</span> <span class="mi">1</span><span class="n">B</span> <span class="mi">8</span><span class="n">B</span> <span class="mi">3</span><span class="n">B</span> <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;2 2 2&quot;</span> <span class="s2">&quot;1&quot;</span> <span class="s2">&quot;2&quot;</span> <span class="s2">&quot;1 2 4 8 16 32 64 128&quot;</span> <span class="s2">&quot;0 0 0&quot;</span> <span class="s2">&quot;5&quot;</span> <span class="s2">&quot;1&quot;</span> <span class="s2">&quot;1 1 4 8 16 32 64 128&quot;</span> <span class="s2">&quot;0 0 0&quot;</span>
</pre></div>
</div>
<p>It produces the following output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sof m4 and ALSA conf format:
`       bytes &quot;0x53,0x4f,0x46,0x00,0x12,0x00,0x00,0x00,0x3c,&#39;
`       0x00,0x00,0x00,0x00,0xe0,0x00,0x03,0x00,&#39;
`       0x00,0x00,0x00,0x02,0x00,0x02,0x00,0x02,&#39;
`       0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x02,&#39;
`       0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,&#39;
`       0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x01,&#39;
`       0x01,0x01,0x04,0x08,0x10,0x20,0x40,0x80,&#39;
`       0x00,0x00,0x00,&#39;

sof ctl tool format:
(4607827, 18, 60, 50388992, 0, 2, 2, 2, 1, 2, 1, 2, 4, 8, 16, 32, 64, 128, 0, 0, 0, 5, 1, 1, 1, 4, 8, 16, 32, 64, 128, 0, 0, 0)
</pre></div>
</div>
<p>The sof-ctl tool can be then used to set the parameters through ALSA control:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sof-ctl -Dhw:0 -n <span class="m">22</span> -s demux_coeffs.txt
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tdfb/time_domain_fixed_beamformer.html" class="btn btn-neutral float-right" title="Time Domain Fixed Beamformer (TDFB)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../src/sample_rate_conversion.html" class="btn btn-neutral" title="Sample Rate Conversion" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2021, SOF Project..
      Last updated on May 10, 2022.

    </p>
</td>
<td id="zcanlogo">
  <a href="https://www.unisim-micro.com/"><img src="../../_static/images/zcan.svg" border="0" style="position:static"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> SOF Project</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version zcansdk">
        <a href="../../../zcansdk/index.html">ZCAN IOT SDK</a>
      </div>
      
      <div class="rst-other-version zcanxlib">
        <a href="../../../zcanxlib/README.html">ZCAN Xlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>