

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Work Queues &mdash; SOF Project 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/sof.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  
  

  

  
  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
  <script type="text/javascript" src="../../../_static/js/zcaniot.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Multicore Processing" href="multicore-processing.html" />
    <link rel="prev" title="CAVS Commons" href="index.html" />
  <link rel="shortcut icon" href="../../../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> SOF Project
          

          
            
            <img src="../../../_static/logo_sof_white_200w.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://sofproject.org">SOF project website</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction to the SOF Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architectures/index.html">Supported Architectures</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Platforms</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#supported-platforms">Supported Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#minimum-platform-requirements">Minimum Platform Requirements</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#platform-specific-information">Platform Specific Information</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../intel-legacy/index.html">Intel Hifi2-EP Platforms</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Intel CAVS Platforms</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html">CAVS Commons</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apollolake/index.html">Intel Apollo Lake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cannonlake/index.html">Intel Cannon Lake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../icelake/index.html">Intel Ice Lake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tigerlake/index.html">Intel Tiger Lake</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../algos/index.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guides/index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release.html">Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contributing to the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tsc/index.html">Technical Steering Committee (TSC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainers/index.html">SOF admin, maintainers and code owners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../presentations/index.html">Presentations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SOF Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Platforms</a> &raquo;</li>
        
          <li><a href="../index.html">Intel CAVS Platforms</a> &raquo;</li>
        
          <li><a href="index.html">CAVS Commons</a> &raquo;</li>
        
      <li>Work Queues</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/platforms/intel-cavs/commons/work-queue.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="work-queues">
<span id="platform-cavs-work-queue"></span><h1>Work Queues<a class="headerlink" href="#work-queues" title="Permalink to this headline">¶</a></h1>
<p>On CAVS platforms, the wall clock is used as a time source for multiple work
queues (one work queue instance per active core).</p>
<p>Since enough comparators are not available, all instances register to a shared
interrupt where one comparator is used to wake up all. The primary core
re-programs the wall clock to the next wake event. Its work queue operates in
<em>primary mode</em>. Work queues running on other cores are attached to the shared
time source on CAVS SMP platforms; these are configured to the <em>secondary mode</em>. On
other SMP platforms where multiple independent time sources are available, all
queues can be configured in <em>primary mode</em>.</p>
<div class="section" id="synchronous-systick-on-all-cores">
<h2>Synchronous SysTick on All Cores<a class="headerlink" href="#synchronous-systick-on-all-cores" title="Permalink to this headline">¶</a></h2>
<p>The shared time source aligns work scheduling on all cores as all synchronously
wake up on the same periodic event via a system tick timer, or <em>SysTick</em>.</p>
<p>SysTick periods are configurable. While no resolution is guaranteed, the
default value of 1ms is acceptable for works that are typically scheduled on
this system, specifically low latency works that are enabled and can be run on
multiple cores in sync. For ultra low latency configurations, the SysTick
period can be configured to a value of &lt; 1ms.</p>
<p>An HD/A DMA running in circular buffer mode (&#64; dai) is already registered in
the work queue with a specified timeout period of 1ms. Other DMAs can be
switched from their individual interrupt sources (buffer completion) to work
queues, thus making pipelines scheduling fully <em>systick aligned</em>.</p>
<p>In the case of more complex topologies, pipelines that start/terminate with a
component other then dai can be also driven by work queues.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Work queue primary/secondary mode vs. independent mode configurable by
CONFIG &#64; compile time. The work queue min tick (1ms/0.33ms/1us) is
configurable &#64; run-time so that the current mode is still fully supported.</p>
</div>
<div class="figure align-default" id="id1">
<p class="plantuml">
<object data="../../../_images/plantuml-1861c1089dc6b4a810bf68c271d4b4cb011917c8.svg" type="image/svg+xml" style="width:508px;height:781px;">
<img src="../../../_images/plantuml-1861c1089dc6b4a810bf68c271d4b4cb011917c8.png" alt="scale max 800 height

skinparam rectangle {
   backgroundColor&lt;&lt;dai&gt;&gt; #6fccdd
   backgroundColor&lt;&lt;dma&gt;&gt; #f6ed80
   backgroundColor&lt;&lt;stream&gt;&gt; #d6d6de
   borderColor&lt;&lt;stream&gt;&gt; #d6d6de
   borderColor&lt;&lt;ppl&gt;&gt; #a1a1ca

   backgroundColor&lt;&lt;event&gt;&gt; #f05772
   stereotypeFontColor&lt;&lt;event&gt;&gt; #ffffff
   fontColor&lt;&lt;event&gt;&gt; #ffffff

   backgroundColor&lt;&lt;cpu&gt;&gt; #f0f0f0
}

together {
   ' ssp dais
   rectangle &quot;ssp-dai #0&quot; as ssp_0 &lt;&lt;dai&gt;&gt;
   rectangle &quot;ssp-dai #1&quot; as ssp_1 &lt;&lt;dai&gt;&gt;
   ' hda dais
   rectangle &quot;hda-dai #0&quot; as hda_0 &lt;&lt;dai&gt;&gt;
}

rectangle &quot;core #0&quot; &lt;&lt;cpu&gt;&gt; {

   together {
      rectangle &quot;hda-dma\nhost output #0&quot; as hda_dma_ho_0 &lt;&lt;dma&gt;&gt;
      rectangle &quot;hda-dma\nhost input #0&quot; as hda_dma_hi_0 &lt;&lt;dma&gt;&gt;
   }
   together {
      rectangle &quot;dw-dma #0&quot; as dw_dma_0 &lt;&lt;dma&gt;&gt;
      rectangle &quot;dw-dma #1&quot; as dw_dma_1 &lt;&lt;dma&gt;&gt;
   }

   rectangle &quot;playback #0&quot; &lt;&lt;stream&gt;&gt; {

      rectangle &quot;ppl #0&quot; as ppl_0 &lt;&lt;ppl&gt;&gt; {
         rectangle &quot;host comp&quot; as host_0
         rectangle &quot;vol&quot; as vol_0
         rectangle &quot;mix-in&quot; as mix_in_0

         host_0 --&gt; vol_0
         vol_0 --&gt; mix_in_0
      }

      rectangle &quot;ppl #1&quot; as ppl_1 &lt;&lt;ppl&gt;&gt; {
         rectangle &quot;mix-out&quot; as mix_out_1
         rectangle &quot;dai comp&quot; as dai_1

         mix_out_1 --&gt; dai_1
      }
      mix_in_0 --&gt; mix_out_1
   }
   hda_dma_ho_0 --&gt; host_0

   dai_1 --&gt; dw_dma_0
   dw_dma_0 --&gt; ssp_0

   rectangle &quot;capture #0&quot; &lt;&lt;stream&gt;&gt; {
      rectangle &quot;ppl #3&quot; as ppl_3 &lt;&lt;ppl&gt;&gt; {
         rectangle &quot;host comp&quot; as host_3
         rectangle &quot;dai comp&quot; as dai_3
         host_3 &lt;-- dai_3
      }
   }
   hda_dma_hi_0 &lt;-- host_3
   dai_3 &lt;-- dw_dma_1
   dw_dma_1 &lt;-- ssp_1

   ' now let's show who's driving
   rectangle &quot;work queue #0\n&#64;core_0&quot; as wq_0 &lt;&lt;event&gt;&gt;
   wq_0 .[#green]&gt; mix_in_0
   wq_0 .[#green]&gt; dw_dma_0 : new
   wq_0 .[#green]&gt; dw_dma_1 : new
}

rectangle &quot;core #1&quot; &lt;&lt;cpu&gt;&gt; {

   rectangle &quot;hda-dma\nhost output #1&quot; as hda_dma_ho_1 &lt;&lt;dma&gt;&gt;
   rectangle &quot;hda-dma\nlink input #0&quot; as hda_dma_li_0 &lt;&lt;dma&gt;&gt;


   rectangle &quot;playback #1&quot; &lt;&lt;stream&gt;&gt; {
      rectangle &quot;ppl #2&quot; as ppl_2 &lt;&lt;ppl&gt;&gt; {

         rectangle &quot;host comp&quot; as host_2
         rectangle &quot;dai comp&quot; as dai_2

         host_2 --&gt; dai_2
      }
   }
   hda_dma_ho_1 --&gt; host_2
   dai_2 --&gt; hda_dma_li_0
   hda_dma_li_0 --&gt; hda_0

   rectangle &quot;work queue #1\n&#64;core_1&quot; as wq_1 &lt;&lt;event&gt;&gt;
   wq_1 .[#green]&gt; hda_dma_li_0
}
"/>

</object></p>
<p class="caption"><span class="caption-number">Figure 10 </span><span class="caption-text">Work queue dependecies for CAVS SMP</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id2">
<p class="plantuml">
<object data="../../../_images/plantuml-82855b07b66758acc609a6e637a3df9713384ff7.svg" type="image/svg+xml" style="width:655px;height:893px;">
<img src="../../../_images/plantuml-82855b07b66758acc609a6e637a3df9713384ff7.png" alt="participant ipc
participant &quot;core 0&quot; as core_0
participant &quot;core 1&quot; as core_1
participant wallclk

ipc -&gt; core_0 : new pipeline 0 (&#64;core 0)
   activate core_0
   core_0 -&gt; wallclk : timer_register()
   core_0 -&gt; core_0 : work_schedule(ppl 0 dai, +1ms)
   core_0 -&gt; wallclk : work_set_timer(period = +1ms)
ipc &lt;-- core_0
deactivate core_0

wallclk -&gt; core_0 : cb() &#64; next ms
   activate core_0
   core_0 -&gt; core_0 : ppl 0 dai cb()
      activate core_0
         core_0 -&gt; core_0 : ppl 0 copy
         core_0 -&gt; core_0 : work_schedule(ppl 0 dai, +1ms)
      deactivate core_0
   core_0 -&gt; wallclk : work_set_timer()
   deactivate core_0

ipc -&gt; core_0 : new pipeline 1 (&#64;core 1)
   core_0 -&gt; core_1
   activate core_1
      core_1 -&gt; wallclk : timer_register()
      core_1 -&gt; core_1 : work_schedule(ppl 1 dai)
   core_0 &lt;-- core_1
   deactivate core_1

wallclk -&gt; core_0 : cb() &#64; next ms
   activate core_0
   activate core_1
   core_0 -&gt; core_0 : ppl 0 dai cb()
      activate core_0
         core_0 -&gt; core_0 : ppl 0 copy
         core_0 -&gt; core_0 : work_schedule(ppl 0 dai, +1ms)
      deactivate core_0
   core_1 -&gt; core_1 : ppl 1 dai cb()
      activate core_1
         core_1 -&gt; core_1 : ppl 1 copy
         core_1 -&gt; core_1 : work_schedule(ppl 1 dai, +1ms)
      deactivate core_1
   deactivate core_1
   core_0 -&gt; wallclk : work_set_timer()
   deactivate core_0
"/>

</object></p>
<p class="caption"><span class="caption-number">Figure 11 </span><span class="caption-text">Work queue flow for CAVS SMP</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="multicore-processing.html" class="btn btn-neutral float-right" title="Multicore Processing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="CAVS Commons" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2021, SOF Project..
      Last updated on May 10, 2022.

    </p>
</td>
<td id="zcanlogo">
  <a href="https://www.unisim-micro.com/"><img src="../../../_static/images/zcan.svg" border="0" style="position:static"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> SOF Project</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version zcansdk">
        <a href="../../../../zcansdk/index.html">ZCAN IOT SDK</a>
      </div>
      
      <div class="rst-other-version zcanxlib">
        <a href="../../../../zcanxlib/README.html">ZCAN Xlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>