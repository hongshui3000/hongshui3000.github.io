

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Build SOF from scratch &mdash; SOF Project 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/sof.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
  <script type="text/javascript" src="../../_static/js/zcaniot.js"></script>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Build SOF with Docker" href="build-with-docker.html" />
    <link rel="prev" title="Getting Started Guides" href="../index.html" />
  <link rel="shortcut icon" href="../../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> SOF Project
          

          
            
            <img src="../../_static/logo_sof_white_200w.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://sofproject.org">SOF project website</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction to the SOF Project</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Getting Started Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#build-sof">Build SOF</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Build SOF from scratch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-sof">Build SOF</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-linux-kernel">Build Linux kernel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="build-with-docker.html">Build SOF with Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-3rd-party-toolchain.html">Build SOF with a 3rd Party Toolchain</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-with-zephyr.html">Build SOF with Zephyr</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#set-up-sof-on-hardware">Set up SOF on hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#debug-audio-issues-on-intel-platforms">Debug Audio issues on Intel platforms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../architectures/index.html">Supported Architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/index.html">Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../algos/index.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guides/index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release.html">Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contributing to the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tsc/index.html">Technical Steering Committee (TSC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainers/index.html">SOF admin, maintainers and code owners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentations/index.html">Presentations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SOF Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Getting Started Guides</a> &raquo;</li>
        
      <li>Build SOF from scratch</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/getting_started/build-guide/build-from-scratch.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="build-sof-from-scratch">
<span id="build-from-scratch"></span><h1>Build SOF from scratch<a class="headerlink" href="#build-sof-from-scratch" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#build-sof" id="id3">Build SOF</a></p>
<ul>
<li><p><a class="reference internal" href="#step-0-set-up-the-workspace-directory" id="id4">Step 0 Set up the workspace directory</a></p></li>
<li><p><a class="reference internal" href="#step-1-set-up-build-environment" id="id5">Step 1 Set up build environment</a></p>
<ul>
<li><p><a class="reference internal" href="#install-packaged-dependencies" id="id6">Install packaged dependencies</a></p></li>
<li><p><a class="reference internal" href="#install-cmake" id="id7">Install CMake</a></p></li>
<li><p><a class="reference internal" href="#build-alsa-lib-and-alsa-utils" id="id8">Build alsa-lib and alsa-utils</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#step-2-build-toolchains-from-source" id="id9">Step 2 Build toolchains from source</a></p>
<ul>
<li><p><a class="reference internal" href="#crosstool-ng" id="id10">crosstool-ng</a></p></li>
<li><p><a class="reference internal" href="#toolchains" id="id11">Toolchains</a></p></li>
<li><p><a class="reference internal" href="#additional-headers" id="id12">Additional headers</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#step-3-build-firmware-binaries" id="id13">Step 3 Build firmware binaries</a></p>
<ul>
<li><p><a class="reference internal" href="#one-step-rebuild-from-scratch" id="id14">One-step rebuild from scratch</a></p></li>
<li><p><a class="reference internal" href="#incremental-builds" id="id15">Incremental builds</a></p></li>
<li><p><a class="reference internal" href="#firmware-build-results" id="id16">Firmware build results</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#step-4-build-topology-and-tools" id="id17">Step 4 Build topology and tools</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id18">One-step rebuild from scratch</a></p></li>
<li><p><a class="reference internal" href="#incremental-build" id="id19">Incremental build</a></p></li>
<li><p><a class="reference internal" href="#topology-and-tools-build-results" id="id20">Topology and tools build results</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#build-linux-kernel" id="id21">Build Linux kernel</a></p></li>
</ul>
</div>
<p>You may boot and test Sound Open Firmware on a target machine or VM. Current target
Intel platforms include: Bay Trail, Cherry Trail, Haswell, Broadwell, Apollo Lake, Cannon Lake, Ice Lake and Jasper Lake.</p>
<p>Support also exists for NXP i.MX8/i.MX8X/i.MX8M platforms.</p>
<div class="section" id="build-sof">
<h2><a class="toc-backref" href="#id3">Build SOF</a><a class="headerlink" href="#build-sof" title="Permalink to this headline">¶</a></h2>
<p>The following steps describe how to install the SOF development
environment on Ubuntu 16.04, 18.04, and 18.10. They should work on
19.04, 19.10 and other Linux distributions with minor or no
modifications.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">$SOF_WORKSPACE</span></code> environment variable should point to the directory you
wish to store all sof work in.</p>
<p>The code examples assume <code class="docutils literal notranslate"><span class="pre">$SOF_WORKSPACE</span></code> as the top-level working
directory.  Clone all git repositories at the same directory level
because some default configuration files refer to other clones using
relative locations like <code class="docutils literal notranslate"><span class="pre">../sof/</span></code>.</p>
</div>
<div class="section" id="step-0-set-up-the-workspace-directory">
<h3><a class="toc-backref" href="#id4">Step 0 Set up the workspace directory</a><a class="headerlink" href="#step-0-set-up-the-workspace-directory" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SOF_WORKSPACE</span><span class="o">=</span>~/work/sof
mkdir <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="step-1-set-up-build-environment">
<h3><a class="toc-backref" href="#id5">Step 1 Set up build environment</a><a class="headerlink" href="#step-1-set-up-build-environment" title="Permalink to this headline">¶</a></h3>
<div class="section" id="install-packaged-dependencies">
<h4><a class="toc-backref" href="#id6">Install packaged dependencies</a><a class="headerlink" href="#install-packaged-dependencies" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>For Ubuntu 18.10:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install libgtk-3-dev libsdl1.2-dev libspice-protocol-dev <span class="se">\</span>
   libspice-server-dev libusb-1.0-0-dev libusbredirhost-dev libtool-bin <span class="se">\</span>
   acpica-tools valgrind texinfo virt-manager qemu-kvm <span class="se">\</span>
   libvirt-daemon-system libvirt-clients virtinst libfdt-dev libssl-dev <span class="se">\</span>
   pkg-config help2man gawk libncurses5 libncurses5-dev
</pre></div>
</div>
</li>
<li><p>For Ubuntu 16.04 and 18.04:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install libgtk-3-dev libsdl1.2-dev libspice-protocol-dev <span class="se">\</span>
   libspice-server-dev libusb-1.0-0-dev libusbredirhost-dev libtool-bin <span class="se">\</span>
   iasl valgrind texinfo virt-manager qemu-kvm libvirt-bin virtinst <span class="se">\</span>
   libfdt-dev libssl-dev pkg-config help2man gawk libncurses5 <span class="se">\</span>
   libncurses5-dev
</pre></div>
</div>
</li>
</ul>
<p>If you are using Ubuntu 16.04, the gcc version must be updated to gcc 7.3+
in order for the Advanced Linux Sound Architecture (ALSA) to build.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo add-apt-repository ppa:ubuntu-toolchain-r/test
sudo apt-get update
sudo apt-get install gcc-7 g++-7
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 <span class="m">70</span> --slave /usr/bin/g++ g++ /usr/bin/g++-7
</pre></div>
</div>
</div>
<div class="section" id="install-cmake">
<h4><a class="toc-backref" href="#id7">Install CMake</a><a class="headerlink" href="#install-cmake" title="Permalink to this headline">¶</a></h4>
<p>If you use Ubuntu 18.04+ you can install CMake with apt:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install cmake
</pre></div>
</div>
<p>For Ubuntu 16.04, CMake from apt is outdated and you must install CMake from
sources. Refer to this short guide: <a class="reference external" href="https://cmake.org/install/">https://cmake.org/install/</a></p>
</div>
<div class="section" id="build-alsa-lib-and-alsa-utils">
<h4><a class="toc-backref" href="#id8">Build alsa-lib and alsa-utils</a><a class="headerlink" href="#build-alsa-lib-and-alsa-utils" title="Permalink to this headline">¶</a></h4>
<p>This project requires some new features in <a class="reference external" href="https://git.alsa-project.org/?p=alsa-lib.git">alsa-lib</a> and
<a class="reference external" href="https://git.alsa-project.org/?p=alsa-utils.git">alsa-utils</a>, so build the newest ALSA from source code.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Installing alsa-lib systemwide may break some audio applications.
Only perform this if you know what you are doing. We recommend that you
install it locally (under $HOME) or use Docker
(see <a class="reference internal" href="build-with-docker.html#build-with-docker"><span class="std std-ref">Build SOF with Docker</span></a>.)</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>
git clone git://git.alsa-project.org/alsa-lib
<span class="nb">cd</span> alsa-lib
./gitcompile
sudo make install
</pre></div>
</div>
<p>(Optional) To enable alsabat’s frequency analysis, install the FFT library
before you configure alsa-utils.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install libfftw3-dev libfftw3-doc
</pre></div>
</div>
<p>Clone, build, and install alsa-utils.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>
git clone git://git.alsa-project.org/alsa-utils
<span class="nb">cd</span> alsa-utils
./gitcompile
sudo make install
</pre></div>
</div>
<p>If you run into alsa-lib linking errors, try to re-build it with the libdir
parameter.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ../alsa-lib
./gitcompile --prefix<span class="o">=</span>/usr --libdir<span class="o">=</span>/usr/lib/x86_64-linux-gnu/
sudo make install
<span class="nb">cd</span> ../alsa-utils
./gitcompile --prefix<span class="o">=</span>/usr --with-curses<span class="o">=</span>ncurses --disable-xmlto --disable-bat
sudo make install
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the gitcompile script does not work, refer to the INSTALL file for
manual build instructions.</p>
</div>
<p>Create or append to the <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> environment variable.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SOF_WORKSPACE</span><span class="si">}</span><span class="s2">&quot;</span>/alsa-lib/src/.libs:<span class="nv">$LD_LIBRARY_PATH</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-2-build-toolchains-from-source">
<span id="build-toolchains-from-source"></span><h3><a class="toc-backref" href="#id9">Step 2 Build toolchains from source</a><a class="headerlink" href="#step-2-build-toolchains-from-source" title="Permalink to this headline">¶</a></h3>
<p>Build the xtensa cross-compilation toolchains with crosstool-ng for Intel Bay Trail,
Cherry Trail, Haswell, Broadwell, Apollo Lake, Cannon Lake, Ice Lake, Jasper Lake platforms and NXP i.MX8/i.MX8X/i.MX8M
platforms.</p>
<div class="section" id="crosstool-ng">
<h4><a class="toc-backref" href="#id10">crosstool-ng</a><a class="headerlink" href="#crosstool-ng" title="Permalink to this headline">¶</a></h4>
<p>Clone both repos and check out the <code class="docutils literal notranslate"><span class="pre">sof-gcc8.1</span></code> branch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>
git clone https://github.com/thesofproject/xtensa-overlay
git clone https://github.com/thesofproject/crosstool-ng
<span class="nb">cd</span> xtensa-overlay
git checkout sof-gcc8.1
<span class="nb">cd</span> ../crosstool-ng
git checkout sof-gcc8.1
</pre></div>
</div>
<p>Build crosstool-ng and install it in its own source directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./bootstrap
./configure --prefix<span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
make
make install
</pre></div>
</div>
</div>
<div class="section" id="toolchains">
<h4><a class="toc-backref" href="#id11">Toolchains</a><a class="headerlink" href="#toolchains" title="Permalink to this headline">¶</a></h4>
<p>The config files provided refer to <code class="docutils literal notranslate"><span class="pre">../xtensa-overlay/</span></code> and point at
different <code class="docutils literal notranslate"><span class="pre">./build/xtensa-*-elf</span></code> subdirectories. Copy the ones you
want to <code class="docutils literal notranslate"><span class="pre">.config</span></code> and build the cross-compiler(s) for your target
platform(s). <code class="docutils literal notranslate"><span class="pre">./ct-ng</span> <span class="pre">build</span></code> requires an network connection to
download gcc components.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Baytrail/Cherrytrail</span>
cp config-byt-gcc8.1-gdb8.1 .config
./ct-ng build
<span class="c1"># Haswell/Broadwell</span>
cp config-hsw-gcc8.1-gdb8.1 .config
./ct-ng build
<span class="c1"># Apollo Lake</span>
cp config-apl-gcc8.1-gdb8.1 .config
./ct-ng build
<span class="c1"># Cannon Lake, Ice Lake and Jasper Lake</span>
cp config-cnl-gcc8.1-gdb8.1 .config
./ct-ng build
<span class="c1"># i.MX8/i.MX8X</span>
cp config-imx-gcc8.1-gdb8.1 .config
./ct-ng build
<span class="c1"># i.MX8M</span>
cp config-imx8m-gcc8.1-gdb8.1 .config
./ct-ng build
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">./ct-ng</span></code> is a Linux kernel style Makefile; so the sample commands below
can be used to fix some out of date <code class="docutils literal notranslate"><span class="pre">config-*-gcc8.1-gdb8.1</span></code> file or find
default values missing from it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./ct-ng <span class="nb">help</span>
cp config-apl-gcc8.1-gdb8.1 .config
./ct-ng oldconfig <span class="nv">V</span><span class="o">=</span><span class="m">1</span>
diff -u config-apl-gcc8.1-gdb8.1 .config
</pre></div>
</div>
<p>“Install” toolchains by copying them to <code class="docutils literal notranslate"><span class="pre">$SOF_WORKSPACE</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls builds/
<span class="c1"># xtensa-apl-elf  xtensa-byt-elf   xtensa-cnl-elf   xtensa-hsw-elf  xtensa-imx-elf  xtensa-imx8m-elf</span>
cp -r builds/* <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Haswell and Broadwell share the same toolchain: xtensa-hsw-elf</p>
<p>Bay Trail and Cherry Trail share the same toolchain: xtensa-byt-elf</p>
<p>Cannon Lake, Ice Lake and Jasper Lake share the same toolchain: xtensa-cnl-elf</p>
<p>i.MX8 and i.MX8X share the same toolchain: xtensa-imx-elf</p>
</div>
<p>Add your toolchains to your PATH variable.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SOF_WORKSPACE</span><span class="si">}</span><span class="s2">&quot;</span>/xtensa-byt-elf/bin/:<span class="nv">$PATH</span>
<span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SOF_WORKSPACE</span><span class="si">}</span><span class="s2">&quot;</span>/xtensa-hsw-elf/bin/:<span class="nv">$PATH</span>
<span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SOF_WORKSPACE</span><span class="si">}</span><span class="s2">&quot;</span>/xtensa-apl-elf/bin/:<span class="nv">$PATH</span>
<span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SOF_WORKSPACE</span><span class="si">}</span><span class="s2">&quot;</span>/xtensa-cnl-elf/bin/:<span class="nv">$PATH</span>
<span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SOF_WORKSPACE</span><span class="si">}</span><span class="s2">&quot;</span>/xtensa-imx-elf/bin/:<span class="nv">$PATH</span>
<span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SOF_WORKSPACE</span><span class="si">}</span><span class="s2">&quot;</span>/xtensa-imx8m-elf/bin/:<span class="nv">$PATH</span>
</pre></div>
</div>
</div>
<div class="section" id="additional-headers">
<h4><a class="toc-backref" href="#id12">Additional headers</a><a class="headerlink" href="#additional-headers" title="Permalink to this headline">¶</a></h4>
<p>To get some required headers, clone the following newlib repository and
switch to the <cite>xtensa</cite> branch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>
git clone https://github.com/jcmvbkbc/newlib-xtensa
<span class="nb">cd</span> newlib-xtensa
git checkout -b xtensa origin/xtensa
</pre></div>
</div>
<p>Build and install for each platform.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">XTENSA_ROOT</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SOF_WORKSPACE</span><span class="si">}</span><span class="s2">&quot;</span>/xtensa-root
<span class="c1"># Baytrail/Cherrytrail</span>
./configure --target<span class="o">=</span>xtensa-byt-elf --prefix<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">XTENSA_ROOT</span><span class="si">}</span><span class="s2">&quot;</span>
make
make install
rm -fr rm etc/config.cache
<span class="c1"># Haswell/Broadwell</span>
./configure --target<span class="o">=</span>xtensa-hsw-elf --prefix<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">XTENSA_ROOT</span><span class="si">}</span><span class="s2">&quot;</span>
make
make install
rm -fr rm etc/config.cache
<span class="c1"># Apollo Lake</span>
./configure --target<span class="o">=</span>xtensa-apl-elf --prefix<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">XTENSA_ROOT</span><span class="si">}</span><span class="s2">&quot;</span>
make
make install
rm -fr rm etc/config.cache
<span class="c1"># Cannon Lake, Ice Lake and Jasper Lake</span>
./configure --target<span class="o">=</span>xtensa-cnl-elf --prefix<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">XTENSA_ROOT</span><span class="si">}</span><span class="s2">&quot;</span>
make
make install
rm -fr rm etc/config.cache
<span class="c1"># i.MX8/i.MX8X</span>
./configure --target<span class="o">=</span>xtensa-imx-elf --prefix<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">XTENSA_ROOT</span><span class="si">}</span><span class="s2">&quot;</span>
make
make install
rm -fr rm etc/config.cache
<span class="c1"># i.MX8M</span>
./configure --target<span class="o">=</span>xtensa-imx8m-elf --prefix<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">XTENSA_ROOT</span><span class="si">}</span><span class="s2">&quot;</span>
make
make install
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">--prefix=</span></code> expects an absolute path. Define XTENSA_ROOT according to your
environment.</p>
</div>
<p>The required headers are now in <code class="docutils literal notranslate"><span class="pre">&quot;$SOF_WORKSPACE&quot;/xtensa-root</span></code>, and cross-compilation
toolchains for xtensa DSPs are set up.</p>
</div>
</div>
<div class="section" id="step-3-build-firmware-binaries">
<h3><a class="toc-backref" href="#id13">Step 3 Build firmware binaries</a><a class="headerlink" href="#step-3-build-firmware-binaries" title="Permalink to this headline">¶</a></h3>
<p>After the SOF environment is set up, clone the <em>sof</em> repo.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>
git clone https://github.com/thesofproject/sof
</pre></div>
</div>
<div class="section" id="one-step-rebuild-from-scratch">
<h4><a class="toc-backref" href="#id14">One-step rebuild from scratch</a><a class="headerlink" href="#one-step-rebuild-from-scratch" title="Permalink to this headline">¶</a></h4>
<p>To rebuild Sound Open Firmware in just one step, use
<a class="reference external" href="https://github.com/thesofproject/sof/tree/master/scripts/xtensa-build-all.sh">scripts/xtensa-build-all.sh</a> after setting up the
environment.</p>
<p>Build the firmware for all platforms.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>/sof/
./scripts/xtensa-build-all.sh -a
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This script will only work if the PATH includes both the cross-compiler and
<code class="docutils literal notranslate"><span class="pre">xtensa-root</span></code> and if they are siblings in the same <code class="docutils literal notranslate"><span class="pre">sof</span></code> directory.</p>
</div>
<p>As of April 2020, you may specify one or more of the following platform
arguments: <code class="docutils literal notranslate"><span class="pre">byt</span></code>, <code class="docutils literal notranslate"><span class="pre">cht</span></code>, <code class="docutils literal notranslate"><span class="pre">hsw</span></code>, <code class="docutils literal notranslate"><span class="pre">bdw</span></code>, <code class="docutils literal notranslate"><span class="pre">apl</span></code>, <code class="docutils literal notranslate"><span class="pre">cnl</span></code>,
<code class="docutils literal notranslate"><span class="pre">sue</span></code>, <code class="docutils literal notranslate"><span class="pre">icl</span></code>, <code class="docutils literal notranslate"><span class="pre">jsl</span></code>, <code class="docutils literal notranslate"><span class="pre">imx8</span></code>, <code class="docutils literal notranslate"><span class="pre">imx8x</span></code>, <code class="docutils literal notranslate"><span class="pre">imx8m</span></code>. Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/xtensa-build-all.sh byt
./scripts/xtensa-build-all.sh byt apl
</pre></div>
</div>
<p>For the latest platforms list and help message, run the script without
any argument.  You can also enable debug builds with -d, enable rom
builds with -r and speed up the build with -j [n]</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/xtensa-build-all.sh -d byt
./scripts/xtensa-build-all.sh -d -r apl
./scripts/xtensa-build-all.sh -d -r -j <span class="m">4</span> apl
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>xtensa-build-all.sh script uses <code class="docutils literal notranslate"><span class="pre">rimage</span></code> to build the final firmware image.
<code class="docutils literal notranslate"><span class="pre">rimage</span></code> uses by default a public key included in sof repo for signing.
However, if you need to use some other external key for signing you can
specify the path to your key as environment variable before invoking the build:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PRIVATE_KEY_OPTION</span><span class="o">=</span>-DRIMAGE_PRIVATE_KEY<span class="o">=</span>/path_to_key/private.pem
</pre></div>
</div>
<p>The same export mechanism should work also when building with Docker.</p>
</div>
</div>
<div class="section" id="incremental-builds">
<h4><a class="toc-backref" href="#id15">Incremental builds</a><a class="headerlink" href="#incremental-builds" title="Permalink to this headline">¶</a></h4>
<p>This is a more detailed build guide for the <em>sof</em> repo. Unlike
<code class="docutils literal notranslate"><span class="pre">xtensa-build-all.sh</span></code>, this doesn’t rebuild everything every time.</p>
<p>Snippets below assume that your current directory is the root of the
<code class="docutils literal notranslate"><span class="pre">sof</span></code> clone (<code class="docutils literal notranslate"><span class="pre">&quot;$SOF_WORKSPACE&quot;/sof/</span></code>).</p>
<p>CMake recommends out-of-tree builds. Among others, this lets you build
different configurations/platforms in different build directories from
the same source without starting from scratch.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-j</span></code> argument tells make how many processes to use concurrently.
Select a value that matches your build system.</p>
</div>
<p>for Bay Trail:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_byt <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_byt
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-byt-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-byt-elf ..
make <span class="nb">help</span> <span class="c1"># lists all available targets</span>
make baytrail_defconfig
make bin -j4 <span class="nv">VERBOSE</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>for Cherry Trail:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_cht <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_cht
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-byt-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-byt-elf ..
make cherrytrail_defconfig
make bin -j4
</pre></div>
</div>
<p>for Haswell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_hsw <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_hsw
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-hsw-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-hsw-elf ..
make haswell_defconfig
make bin -j4
</pre></div>
</div>
<p>for Broadwell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_bdw <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_bdw
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-hsw-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-hsw-elf ..
make broadwell_defconfig
make bin -j4
</pre></div>
</div>
<p>for Apollo Lake:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_apl <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_apl
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-apl-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-apl-elf ..
make apollolake_defconfig
make bin -j4
</pre></div>
</div>
<p>for Cannon Lake:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_cnl <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_cnl
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-cnl-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-cnl-elf ..
make cannonlake_defconfig
make bin -j4
</pre></div>
</div>
<p>for Ice Lake:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_icl <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_icl
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-cnl-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-cnl-elf ..
make icelake_defconfig
make bin -j4
</pre></div>
</div>
<p>for Jasper Lake:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_jsl <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_jsl
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-cnl-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-cnl-elf ..
make jasperlake_defconfig
make bin -j4
</pre></div>
</div>
<p>for i.MX8:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_imx8 <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_imx8
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-imx-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-imx-elf ..
make imx8_defconfig
make bin -j4
</pre></div>
</div>
<p>for i.MX8X:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_imx8x <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_imx8x
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-imx-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-imx-elf ..
make imx8x_defconfig
make bin -j4
</pre></div>
</div>
<p>for i.MX8M:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_imx8m <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_imx8m
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-imx8m-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-imx8m-elf ..
make imx8m_defconfig
make bin -j4
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>After the ‘make *_defconfig’ step, you can customize your build with
‘make menuconfig’.</p>
<p>DEBUG and ROM options are available for the FW binary build. Enable them
with ‘make menuconfig’.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build_cnl_custom <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_cnl_custom
cmake -DTOOLCHAIN<span class="o">=</span>xtensa-cnl-elf -DROOT_DIR<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XTENSA_ROOT</span><span class="s2">&quot;</span>/xtensa-cnl-elf ..
make cannonlake_defconfig
make menuconfig <span class="c1"># select/deselect options and save</span>
make bin -j4
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have <a class="reference external" href="https://ninja-build.org/">Ninja</a> installed, you can use it
instead of Make. Just type <em>cmake -GNinja …</em> during the configuration
step.</p>
</div>
</div>
<div class="section" id="firmware-build-results">
<h4><a class="toc-backref" href="#id16">Firmware build results</a><a class="headerlink" href="#firmware-build-results" title="Permalink to this headline">¶</a></h4>
<p>The firmware binary files are located in build_&lt;platform&gt;/src/arch/xtensa/.
Copy them to your target machine’s /lib/firmware/intel/sof folder.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sof-apl.ri  sof-bdw.ri  sof-byt.ri  sof-cht.ri  sof-cnl.ri  sof-hsw.ri
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-4-build-topology-and-tools">
<h3><a class="toc-backref" href="#id17">Step 4 Build topology and tools</a><a class="headerlink" href="#step-4-build-topology-and-tools" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id18">One-step rebuild from scratch</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Without any argument <a class="reference external" href="https://github.com/thesofproject/sof/tree/master/scripts/build-tools.sh">scripts/build-tools.sh</a> rebuilds
only the minimum subset of <a class="reference external" href="https://github.com/thesofproject/sof/tree/master/tools/">tools/</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>/sof/
./scripts/build-tools.sh
./scripts/build-tools.sh -h
usage: ./scripts/build-tools.sh <span class="o">[</span>-t<span class="p">|</span>-f<span class="o">]</span>
    <span class="o">[</span>-t<span class="o">]</span> Build <span class="nb">test</span> topologies
    <span class="o">[</span>-f<span class="o">]</span> Build fuzzer<span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="incremental-build">
<h4><a class="toc-backref" href="#id19">Incremental build</a><a class="headerlink" href="#incremental-build" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>/sof/tools/
mkdir build_tools <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build_tools
cmake ..
make -j4
</pre></div>
</div>
<p>If your <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--version</span></code> is 3.13 or higher, you may prefer the new -B option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -B build_tools/
make  -C build_tools/ -j4 <span class="nv">VERBOSE</span><span class="o">=</span><span class="m">1</span>
rm -rf   build_tools/ <span class="c1"># no need to change directory ever</span>
</pre></div>
</div>
</div>
<div class="section" id="topology-and-tools-build-results">
<h4><a class="toc-backref" href="#id20">Topology and tools build results</a><a class="headerlink" href="#topology-and-tools-build-results" title="Permalink to this headline">¶</a></h4>
<p>The topology files are located in the <em>tools/build_tools/topology</em> folder.
Copy them to the target machine’s /lib/firmware/intel/sof-tplg folder.</p>
<p>The <em>sof-logger</em> tool is in the <em>tools/build_tools/logger</em> folder. Copy it to
the target machine’s /usr/bin directory.</p>
</div>
</div>
</div>
<div class="section" id="build-linux-kernel">
<span id="id2"></span><h2><a class="toc-backref" href="#id21">Build Linux kernel</a><a class="headerlink" href="#build-linux-kernel" title="Permalink to this headline">¶</a></h2>
<p>Sound Open Firmware uses the Linux kernel dev branch, and it must work with other dev
branch firmware and topology. This short section shows how to build
Debian kernel packages tested on Ubuntu in a small number of commands.
Note that these commands rebuild everything from scratch every time which
makes then unsuitably slow for development. If you need to make kernel
code changes, ignore this and look at
<a class="reference internal" href="../setup/setup_ktest_environment.html#setup-ktest-environment"><span class="std std-ref">Set up a Ktest-based environment</span></a>, the <a class="reference external" href="https://github.com/thesofproject/kconfig/blob/master/README.md/">README</a> file of
the kconfig repo, and the <a class="reference internal" href="../../developer_guides/linux_driver/architecture/sof_driver_arch.html#sof-driver-arch"><span class="std std-ref">SOF Driver Architecture</span></a>.</p>
<ol class="arabic">
<li><p>Build the kernel with this branch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install bison flex libelf-dev
<span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$SOF_WORKSPACE</span><span class="s2">&quot;</span>
git clone https://github.com/thesofproject/linux
<span class="nb">cd</span> linux
git checkout topic/sof-dev
make defconfig
git clone https://github.com/thesofproject/kconfig
scripts/kconfig/merge_config.sh .config ./kconfig/base-defconfig ./kconfig/sof-defconfig  ./kconfig/mach-driver-defconfig ./kconfig/hdaudio-codecs-defconfig
<span class="o">(</span>optional<span class="o">)</span> make menuconfig
</pre></div>
</div>
<p>Select the SOF driver support and disable SST drivers.</p>
</li>
<li><p>Make the kernel deb package to install on the target machine.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make deb-pkg -j <span class="m">4</span>
</pre></div>
</div>
</li>
<li><p>Copy the three resulting <em>.deb</em> files to the target machine and install
them.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo dpkg -i /absolute/path/to/deb/file
sudo apt-get install -f
</pre></div>
</div>
</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="build-with-docker.html" class="btn btn-neutral float-right" title="Build SOF with Docker" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral" title="Getting Started Guides" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2021, SOF Project..
      Last updated on May 10, 2022.

    </p>
</td>
<td id="zcanlogo">
  <a href="https://www.unisim-micro.com/"><img src="../../_static/images/zcan.svg" border="0" style="position:static"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> SOF Project</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version zcansdk">
        <a href="../../../zcansdk/index.html">ZCAN IOT SDK</a>
      </div>
      
      <div class="rst-other-version zcanxlib">
        <a href="../../../zcanxlib/README.html">ZCAN Xlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>