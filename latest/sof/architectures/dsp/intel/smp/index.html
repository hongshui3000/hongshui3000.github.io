

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Intel Architecture &mdash; SOF Project 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/sof.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  

  
  

  

  
  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
  <script type="text/javascript" src="../../../../_static/js/zcaniot.js"></script>

    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Platforms" href="../../../../platforms/index.html" />
    <link rel="prev" title="Apollolake Boot Loader" href="../cavs-boot/apollolake/apl-boot-ldr.html" />
  <link rel="shortcut icon" href="../../../../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> SOF Project
          

          
            
            <img src="../../../../_static/logo_sof_white_200w.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://sofproject.org">SOF project website</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/index.html">Introduction to the SOF Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/index.html">Getting Started Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Supported Architectures</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../host/index.html">Host Architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">DSP Architecture</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../index.html#adding-a-new-dsp-architecture-to-sof">Adding a new DSP architecture to SOF</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html#vendor-specific-architecture-information">Vendor Specific Architecture Information</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html#intel">Intel</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../platforms/index.html">Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../algos/index.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guides/index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release.html">Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contribute/index.html">Contributing to the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tsc/index.html">Technical Steering Committee (TSC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../maintainers/index.html">SOF admin, maintainers and code owners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../presentations/index.html">Presentations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">SOF Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Supported Architectures</a> &raquo;</li>
        
          <li><a href="../../index.html">DSP Architecture</a> &raquo;</li>
        
          <li><a href="../index.html">Intel DSP Architecture</a> &raquo;</li>
        
      <li>Intel Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/architectures/dsp/intel/smp/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="intel-architecture">
<span id="architecture-intel-smp"></span><h1>Intel Architecture<a class="headerlink" href="#intel-architecture" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>SMP architecture is used in the environment, where multiple processors are
connected to a single shared memory, have access to all input and output
interfaces, and are controlled by a single operating system. In our case,
we have multiple Xtensa DSP cores, which use the same Firmware binary loaded
to the shared L2 SRAM, and are controlled by the same instance of the XTOS.</p>
</div>
<div class="section" id="using-smp-architecture">
<h2>Using SMP architecture<a class="headerlink" href="#using-smp-architecture" title="Permalink to this headline">¶</a></h2>
<p>Sound Open Firmware implementation of SMP architecture involves separate and modified XTOS,
which can be chosen by selecting appropriate arch flag during configuration
step of building FW binary.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./configure --with-arch<span class="o">=</span>xtensa-smp --with-platform<span class="o">=</span>&lt;platform&gt; --with-dsp-core<span class="o">=</span>&lt;core&gt; --with-root-dir<span class="o">=</span>&lt;root-dir&gt; --host<span class="o">=</span>&lt;host&gt;
</pre></div>
</div>
</div>
<div class="section" id="implementation-details">
<h2>Implementation details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h2>
<p>The data structures critical to core execution need to be instantiated
per core, instead of being accessed using static pointers.
SMP implementation creates <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">core_context</span></code> to meet those demands.
This structure contains pointers to the XTOS data along with
<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">irq_task</span></code>, <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">schedule_data</span></code>, <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">work_queue</span></code> etc.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">core_context</span> <span class="p">{</span>
   <span class="k">struct</span> <span class="nc">thread_data</span> <span class="n">td</span><span class="p">;</span>
   <span class="k">struct</span> <span class="nc">irq_task</span> <span class="o">*</span><span class="n">irq_low_task</span><span class="p">;</span>
   <span class="k">struct</span> <span class="nc">irq_task</span> <span class="o">*</span><span class="n">irq_med_task</span><span class="p">;</span>
   <span class="k">struct</span> <span class="nc">irq_task</span> <span class="o">*</span><span class="n">irq_high_task</span><span class="p">;</span>
   <span class="k">struct</span> <span class="nc">schedule_data</span> <span class="o">*</span><span class="n">sch</span><span class="p">;</span>
   <span class="k">struct</span> <span class="nc">work_queue</span> <span class="o">*</span><span class="n">queue</span><span class="p">;</span>
   <span class="k">struct</span> <span class="nc">idc</span> <span class="o">*</span><span class="n">idc</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">core_context</span></code> is allocated by primary core for secondary cores before
secondary core boot. Address of the <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">core_context</span></code> is written into
<code class="docutils literal notranslate"><span class="pre">THREADPTR</span></code> processor register, which can later be retrieved by the secondary core
after boot. Every core has its own instance of <code class="docutils literal notranslate"><span class="pre">THREADPTR</span></code>,
so <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">core_context</span></code> address can be read anytime at any place of the code.</p>
</div>
<div class="section" id="communication-between-cores">
<h2>Communication between cores<a class="headerlink" href="#communication-between-cores" title="Permalink to this headline">¶</a></h2>
<p>Primary core can communicate with secondary cores by sending messages using
the IDC mechanism. This mechanism is pretty much the same as IPC.
Important data can be sent in two 32-bit IDC registers. Cores use interrupts
to register for the incoming messages.</p>
<p class="plantuml">
<object data="../../../../_images/plantuml-05cf52f13af44048b7743a7a46dc349edd7c8947.svg" type="image/svg+xml" style="width:611px;height:301px;">
<img src="../../../../_images/plantuml-05cf52f13af44048b7743a7a46dc349edd7c8947.png" alt="participant core0
participant core1
participant idc
participant platform

core0 -&gt; idc : idc_init()
   activate idc

   idc -&gt; platform : interrupt_register(irq, auto_unmask, irq_handler, idc)
      activate platform
   idc &lt;-- platform
   deactivate platform

core0 &lt;-- idc
deactivate idc

core0 -&gt; idc : idc_send_msg(idc_msg, mode)
   activate idc

   idc -&gt; core1 : irq_handler()
      activate core1
   idc &lt;-- core1
   deactivate core1
core0 &lt;-- idc
deactivate idc

core1 -&gt; idc : idc_do_cmd(data)
   activate idc
idc &lt;-- core1
deactivate idc
"/>

</object></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../../platforms/index.html" class="btn btn-neutral float-right" title="Platforms" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../cavs-boot/apollolake/apl-boot-ldr.html" class="btn btn-neutral" title="Apollolake Boot Loader" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2021, SOF Project..
      Last updated on May 10, 2022.

    </p>
</td>
<td id="zcanlogo">
  <a href="https://www.unisim-micro.com/"><img src="../../../../_static/images/zcan.svg" border="0" style="position:static"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> SOF Project</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version zcansdk">
        <a href="../../../../../zcansdk/index.html">ZCAN IOT SDK</a>
      </div>
      
      <div class="rst-other-version zcanxlib">
        <a href="../../../../../zcanxlib/README.html">ZCAN Xlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>