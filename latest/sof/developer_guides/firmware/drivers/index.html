

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Drivers &mdash; SOF Project 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/zc.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/sof.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  
  

  

  
  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
  <script type="text/javascript" src="../../../_static/js/zcaniot.js"></script>

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="DMA Drivers" href="dma/index.html" />
    <link rel="prev" title="Schedulers" href="../schedulers.html" />
  <link rel="shortcut icon" href="../../../_static/images/favicon.ico"/>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> SOF Project
          

          
            
            <img src="../../../_static/logo_sof_white_200w.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://sofproject.org">SOF project website</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction to the SOF Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architectures/index.html">Supported Architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../platforms/index.html">Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../algos/index.html">Algorithms</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Firmware</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../component-tutorial/tut-intro.html">Hello World Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mem-mgmt.html">Memory Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pm-runtime/index.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../schedulers.html">Schedulers</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Drivers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#registering-the-devices">Registering the Devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="#probing-on-demand">Probing on Demand</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api">API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/index.html">Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pipelines/index.html">Pipelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../porting.html">Porting Guides</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kd_integration/index.html">Keyword detection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmake.html">CMake Arguments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../unit_tests.html">Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../xtrun/index.html">Xtensa Simulator (xt-run)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topology/topology.html">SOF Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../uuid/index.html">UUID Usage in SOF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debugability/index.html">Debugability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tuning/sof-ctl.html">Runtime Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../rimage/index.html">Rimage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linux_driver/index.html">SOF Linux Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../virtualization/virtualization.html">SOF VirtIO design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../virtualization/running.html">Run SOF VirtIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fuzzing/index.html">Fuzzing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testbench/index.html">Testbench</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#technical-notes">Technical Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../release.html">Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contributing to the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tsc/index.html">Technical Steering Committee (TSC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainers/index.html">SOF admin, maintainers and code owners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../presentations/index.html">Presentations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SOF Project</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Developer Guides</a> &raquo;</li>
        
          <li><a href="../index.html">Firmware</a> &raquo;</li>
        
      <li>Drivers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/developer_guides/firmware/drivers/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="drivers">
<span id="id1"></span><h1>Drivers<a class="headerlink" href="#drivers" title="Permalink to this headline">¶</a></h1>
<p>The drivers controls the devices attached to the platform. The following type
of devices are typically available:</p>
<ul class="simple">
<li><p>DMA (Direct Memory Access) devices</p></li>
<li><p>DAI (Digital Audio Interface) devices</p></li>
</ul>
<div class="section" id="registering-the-devices">
<h2>Registering the Devices<a class="headerlink" href="#registering-the-devices" title="Permalink to this headline">¶</a></h2>
<p>The devices are connected to other topology elements when the topology is being
created. The infrastructure (lib) needs to know what devices are available and
how to connect to their drivers’ APIs. The platform initialization routine is
responsible for the device discovery and API registration. The discovery
mechanism depends on the platform. It may be either very simple statically
compiled list of the devices or a dynamic one based on capability information
provided by the underlying HW at run-time.</p>
<div class="figure align-default" id="id2">
<p class="plantuml">
<object data="../../../_images/plantuml-58bc783ce7ba7786c4a0a36910eebbafbffdefe5.svg" type="image/svg+xml" style="width:329px;height:363px;">
<img src="../../../_images/plantuml-58bc783ce7ba7786c4a0a36910eebbafbffdefe5.png" alt="participant &quot;platform&quot; as plat
participant lib

-&gt; plat : platform_init()
   activate plat

   == DAI ==

   plat -&gt; plat : dai_disco() : dai_desc_list
   plat -&gt; lib : dai_install(dai_desc_list)

   == DMA ==

   plat -&gt; plat : dma_disco() : dma_desc_list
   plat -&gt; lib : dma_install(dma_desc_list)

&lt;-- plat
deactivate plat
"/>

</object></p>
<p class="caption"><span class="caption-number">Figure 47 </span><span class="caption-text">Device discovery and registration</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="probing-on-demand">
<h2>Probing on Demand<a class="headerlink" href="#probing-on-demand" title="Permalink to this headline">¶</a></h2>
<p>Creation of the particular device may result in a significant resource
allocation and increased power demand. Therefore the infrastructure does not
create (probe) the devices immediately upon startup. A simple reference
counting mechanism implemented inside the lib allows to probe the devices
on demand and free (remove) them when no longer in use.</p>
<p>The device driver implementation of <code class="docutils literal notranslate"><span class="pre">remove()</span></code> API is required to free all
the resources allocated in <code class="docutils literal notranslate"><span class="pre">probe()</span></code> and power-gate unused HW blocks.</p>
<div class="figure align-default" id="id3">
<p class="plantuml">
<object data="../../../_images/plantuml-5bca4677a2c0106e491d30b345c6dc6e2c2f7c38.svg" type="image/svg+xml" style="width:620px;height:418px;">
<img src="../../../_images/plantuml-5bca4677a2c0106e491d30b345c6dc6e2c2f7c38.png" alt="participant &quot;component&quot; as comp
participant lib
participant ukernel
participant &quot;driver&quot; as drv
participant hw

-&gt; comp : new()

comp -&gt; lib : dai_get(type, ...)
   activate lib

   lib -&gt; lib : lookup(dai_desc_list) : dai_desc
   opt dai_desc-&gt;sref == 0
      lib -&gt; drv : dai_desc-&gt;ops-&gt;probe(dai_desc)
         activate drv
         drv -&gt; hw : ungate power
         drv -&gt; ukernel : alloc mem
      lib &lt;-- drv : Success
      deactivate drv
   end opt
   lib -&gt; lib : dai_desc-&gt;sref++

comp &lt;-- lib : dev*
deactivate lib
"/>

</object></p>
<p class="caption"><span class="caption-number">Figure 48 </span><span class="caption-text">Creating the device on the first use</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id4">
<p class="plantuml">
<object data="../../../_images/plantuml-0318aad4823ef945d25cea3a84915fd7b4fac35d.svg" type="image/svg+xml" style="width:478px;height:311px;">
<img src="../../../_images/plantuml-0318aad4823ef945d25cea3a84915fd7b4fac35d.png" alt="participant &quot;component&quot; as comp
participant lib
participant ukernel
participant &quot;driver&quot; as drv
participant hw

-&gt; comp : free()

comp -&gt; lib : dai_put(dev*)
   activate lib

   opt --dai_desc-&gt;sref == 0
      lib -&gt; drv : dai_desc-&gt;ops-&gt;remove(dev)
         activate drv
         drv -&gt; ukernel : free mem
         drv -&gt; hw : gate power
      lib &lt;-- drv : Success
      deactivate drv
   end opt

comp &lt;-- lib
deactivate lib
"/>

</object></p>
<p class="caption"><span class="caption-number">Figure 49 </span><span class="caption-text">Removing the device when no longer in use</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>The drivers are located at: <em>src/drivers</em></p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="dma/index.html">DMA Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="dai/index.html">DAI Drivers</a></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dma/index.html" class="btn btn-neutral float-right" title="DMA Drivers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../schedulers.html" class="btn btn-neutral" title="Schedulers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2021, SOF Project..
      Last updated on May 10, 2022.

    </p>
</td>
<td id="zcanlogo">
  <a href="https://www.unisim-micro.com/"><img src="../../../_static/images/zcan.svg" border="0" style="position:static"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> SOF Project</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <div class="rst-other-version zcansdk">
        <a href="../../../../zcansdk/index.html">ZCAN IOT SDK</a>
      </div>
      
      <div class="rst-other-version zcanxlib">
        <a href="../../../../zcanxlib/README.html">ZCAN Xlib</a>
      </div>
      
      <div class="rst-other-version zephyr">
        <a href="../../../../zephyr/index.html">Zephyr Project</a>
      </div>
      
      <div class="rst-other-version mcuboot">
        <a href="../../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      
      <div class="rst-other-version kconfig">
        <a href="../../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>